Hive

Creating tables and loading data

    Create database
    Create tables using text file format
    Make sure structure of data and the delimiters specified while create tables are same
    If so, one can load data into Hive table using load command


create database dgadiraju_retail_db_txt;
use dgadiraju_retail_db_txt;

create table orders (
  order_id int,
  order_date string,
  order_customer_id int,
  order_status string
) row format delimited fields terminated by ','
stored as textfile;

load data local inpath '/data/retail_db/orders' into table orders;

create table order_items (
  order_item_id int,
  order_item_order_id int,
  order_item_product_id int,
  order_item_quantity int,
  order_item_subtotal float,
  order_item_product_price float
) row format delimited fields terminated by ','
stored as textfile;

load data local inpath '/data/retail_db/order_items' into table order_items;

hive> dfs -ls /

hive> dfs -ls /data/retail_db/;
Found 6 items
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/categories
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/customers
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/departments
drwxr-xr-x   - hduser supergroup          0 2018-12-25 11:32 /data/retail_db/order_items
drwxr-xr-x   - hduser supergroup          0 2018-12-25 11:30 /data/retail_db/orders
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/products



****** hive landugae manual for all comamds during exam


Creating tables and insert data

    Hive supports other file formats
        avro
        orc
        parquet
        sequencefile
        and more
    When we use special file formats, most likely
        Create staging table where structure matches data
        Create table with the format you are interested in
        Use insert command to get data from stage table into final table




For other file formats,we need to use "insert" commands.
When these formats are used,delimiter is not required to be given in the table creation command bcz it stores metadata.

create database dgadiraju_retail_db_orc;
use dgadiraju_retail_db_orc;

create table orders (
  order_id int,
  order_date string,
  order_customer_id int,
  order_status string
) stored as orc;

insert into table orders select * from dgadiraju_retail_db_txt.orders;

create table order_items (
  order_item_id int,
  order_item_order_id int,
  order_item_product_id int,
  order_item_quantity int,
  order_item_subtotal float,
  order_item_product_price float
) stored as orc;

insert into table order_items select * from dgadiraju_retail_db_txt.order_items;


******************** Spark SQL â€“ Functions

Spark SQL or Hive have bunch of functions to apply transformations on the data.

    String manipulating functions
    Data manipulating functions
    Type cast functions
    Functions to deal with nulls
    Aggregating functions
    Conditional expressions
    and more


to list functions suported by hive,

hive> show functions
    > ;
OK
!
!=
$sum0
%
&
*
+
-
/
<
<=
<=>
<>
=
==
>
>=
^
abs
acos
add_months
aes_decrypt



hive> describe function avg;
OK
avg(x) - Returns the mean of a set of numbers
Time taken: 0.019 seconds, Fetched: 1 row(s)
hive> describe function sum;
OK
sum(x) - Returns the sum of a set of numbers
Time taken: 0.009 seconds, Fetched: 1 row(s)
hive> 


To test a function,

hive> select length('hello raj');
OK
9
Time taken: 0.212 seconds, Fetched: 1 row(s)


