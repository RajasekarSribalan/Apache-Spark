Hive

Creating tables and loading data

    Create database
    Create tables using text file format
    Make sure structure of data and the delimiters specified while create tables are same
    If so, one can load data into Hive table using load command


create database dgadiraju_retail_db_txt;
use dgadiraju_retail_db_txt;

create table orders (
  order_id int,
  order_date string,
  order_customer_id int,
  order_status string
) row format delimited fields terminated by ','
stored as textfile;

load data local inpath '/data/retail_db/orders' into table orders;

create table order_items (
  order_item_id int,
  order_item_order_id int,
  order_item_product_id int,
  order_item_quantity int,
  order_item_subtotal float,
  order_item_product_price float
) row format delimited fields terminated by ','
stored as textfile;

load data local inpath '/data/retail_db/order_items' into table order_items;

hive> dfs -ls /

hive> dfs -ls /data/retail_db/;
Found 6 items
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/categories
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/customers
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/departments
drwxr-xr-x   - hduser supergroup          0 2018-12-25 11:32 /data/retail_db/order_items
drwxr-xr-x   - hduser supergroup          0 2018-12-25 11:30 /data/retail_db/orders
drwxr-xr-x   - hduser supergroup          0 2018-12-19 06:43 /data/retail_db/products



****** hive landugae manual for all comamds during exam


Creating tables and insert data

    Hive supports other file formats
        avro
        orc
        parquet
        sequencefile
        and more
    When we use special file formats, most likely
        Create staging table where structure matches data
        Create table with the format you are interested in
        Use insert command to get data from stage table into final table




For other file formats,we need to use "insert" commands.
When these formats are used,delimiter is not required to be given in the table creation command bcz it stores metadata.

create database dgadiraju_retail_db_orc;
use dgadiraju_retail_db_orc;

create table orders (
  order_id int,
  order_date string,
  order_customer_id int,
  order_status string
) stored as orc;

insert into table orders select * from dgadiraju_retail_db_txt.orders;

create table order_items (
  order_item_id int,
  order_item_order_id int,
  order_item_product_id int,
  order_item_quantity int,
  order_item_subtotal float,
  order_item_product_price float
) stored as orc;

insert into table order_items select * from dgadiraju_retail_db_txt.order_items;


******************** Spark SQL â€“ Functions

Spark SQL or Hive have bunch of functions to apply transformations on the data.

    String manipulating functions
    Data manipulating functions
    Type cast functions
    Functions to deal with nulls
    Aggregating functions
    Conditional expressions
    and more


to list functions suported by hive,

hive> show functions
    > ;
OK
!
!=
$sum0
%
&
*
+
-
/
<
<=
<=>
<>
=
==
>
>=
^
abs
acos
add_months
aes_decrypt



hive> describe function avg;
OK
avg(x) - Returns the mean of a set of numbers
Time taken: 0.019 seconds, Fetched: 1 row(s)
hive> describe function sum;
OK
sum(x) - Returns the sum of a set of numbers
Time taken: 0.009 seconds, Fetched: 1 row(s)
hive> 


To test a function,

hive> select length('hello raj');
OK
9
Time taken: 0.212 seconds, Fetched: 1 row(s)


************* Manipulating Strings ****************

hive> describe function substr
    > ;
OK
substr(str, pos[, len]) - returns the substring of str that starts at pos and is of length len orsubstr(bin, pos[, len]) - returns the slice of byte array that starts at pos and is of length len
Time taken: 0.015 seconds, Fetched: 1 row(s)
hive> describe function substring;
OK
substring(str, pos[, len]) - returns the substring of str that starts at pos and is of length len orsubstring(bin, pos[, len]) - returns the slice of byte array that starts at pos and is of length len
Time taken: 0.021 seconds, Fetched: 1 row(s)
hive> describe function substr;
OK
substr(str, pos[, len]) - returns the substring of str that starts at pos and is of length len orsubstr(bin, pos[, len]) - returns the slice of byte array that starts at pos and is of length len
Time taken: 0.009 seconds, Fetched: 1 row(s)
hive> select 'Hello world, how are you'
    > ;
OK
Hello world, how are you
Time taken: 0.206 seconds, Fetched: 1 row(s)
hive> select 'Hello world, how are you';
OK
Hello world, how are you
Time taken: 0.203 seconds, Fetched: 1 row(s)
hive> select substr('Hello world, how are you',14);
OK
how are you
Time taken: 0.208 seconds, Fetched: 1 row(s)
hive> select substr('Hello world, how are you',7,5);
OK
world
Time taken: 0.143 seconds, Fetched: 1 row(s)
hive> select substr('Hello world, how are you',-3);
OK
you
Time taken: 0.509 seconds, Fetched: 1 row(s)
hive> select substr('Hello world, how are you',-7,3);
OK
are
Time taken: 0.201 seconds, Fetched: 1 row(s)

hive> select instr('Hello world, how are you',' ');
OK
6
Time taken: 0.202 seconds, Fetched: 1 row(s)
hive> select instr('Hello world, how are you','world');
OK
7
Time taken: 0.085 seconds, Fetched: 1 row(s)
hive> select instr('Hello world, how are you','h');
OK
14
Time taken: 0.2 seconds, Fetched: 1 row(s)
hive> select instr('Hello world, how are you','H');
OK
1
Time taken: 0.206 seconds, Fetched: 1 row(s)
hive> select like('Hello world, how are you','h');

hive> select 'Hello world, how are you' like 'Hello%';
OK
true
Time taken: 0.21 seconds, Fetched: 1 row(s)
hive> select 'Hello world, how are you' like '%Hello%';
OK
true
Time taken: 0.135 seconds, Fetched: 1 row(s)
hive> select 'Hello world, how are you' like '%you%';
OK
true
Time taken: 0.209 seconds, Fetched: 1 row(s)
hive> select 'Hello world, how are you' like '%YOU%';
OK
false
Time taken: 0.359 seconds, Fetched: 1 row(s)
hive> select length('Hello world, how are you');
OK
24
Time taken: 0.206 seconds, Fetched: 1 row(s)
hive> select lower('Hello world, how are you');
OK
hello world, how are you
Time taken: 0.208 seconds, Fetched: 1 row(s)
hive> select lcase('Hello world, how are you');
OK
hello world, how are you
Time taken: 0.201 seconds, Fetched: 1 row(s)
hive> select ucase('Hello world, how are you');
OK
HELLO WORLD, HOW ARE YOU
Time taken: 0.85 seconds, Fetched: 1 row(s)
hive> select upper('Hello world, how are you');
OK
HELLO WORLD, HOW ARE YOU
Time taken: 0.2 seconds, Fetched: 1 row(s)
hive> select initcap('Hello world, how are you');
OK
Hello World, How Are You
Time taken: 0.202 seconds, Fetched: 1 row(s)
hive> select '12';
OK
12
Time taken: 0.899 seconds, Fetched: 1 row(s)
hive> select cast('12' as int);
OK
12
Time taken: 0.224 seconds, Fetched: 1 row(s)
hive> select order_date from orders limit 20;
FAILED: SemanticException [Error 10001]: Line 1:23 Table not found 'orders'
hive> show tables;
OK
customers
Time taken: 0.129 seconds, Fetched: 1 row(s)
hive> use retails_db_txt;
FAILED: SemanticException [Error 10072]: Database does not exist: retails_db_txt
hive> show databases;
OK
default
dgadiraju_retail_db_orc
retail_db_txt
Time taken: 0.019 seconds, Fetched: 3 row(s)
hive> use retails_db_txt;
FAILED: SemanticException [Error 10072]: Database does not exist: retails_db_txt
hive> use retail_db_txt;
OK
Time taken: 0.009 seconds
hive> show tables;
OK
order_items
orders
Time taken: 0.017 seconds, Fetched: 2 row(s)
hive> select  order_date from orders limit 10;
OK
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
2013-07-25 00:00:00.0
Time taken: 0.211 seconds, Fetched: 10 row(s)
hive> select  substr(order_date,6,2) from orders limit 10;
OK
07
07
07
07
07
07
07
07
07
07
Time taken: 0.699 seconds, Fetched: 10 row(s)
hive> select  cast(substr(order_date,6,2) as int0 from orders limit 10;

hive> select  cast(substr(order_date,6,2) as int) from orders limit 10;
OK
7
7
7
7
7
7
7
7
7
7
Time taken: 0.299 seconds, Fetched: 10 row(s)
hive> select  substr(order_date,6,2) from orders limit 10;
OK
07
07
07
07
07
07
07
07
07
07
Time taken: 0.133 seconds, Fetched: 10 row(s)
hive> select cast("hello" as int)
    > ;
OK
NULL
Time taken: 0.199 seconds, Fetched: 1 row(s)
hive> select split("hello word hw are you",' ');
OK
["hello","word","hw","are","you"]
Time taken: 0.235 seconds, Fetched: 1 row(s)
hive> select index(split("hello word hw are you",' '),4);
OK
you
Time taken: 0.208 seconds, Fetched: 1 row(s)
hive> select index(split("hello word hw are you",' '),0);
OK
hello
Time taken: 0.211 seconds, Fetched: 1 row(s)
hive> 



********************** Manipulating Dates  **************************

hduser@raj-Lenovo-Y50-70:/usr/local/apache-hive-2.1.0-bin$ hive
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/usr/local/apache-hive-2.1.0-bin/lib/log4j-slf4j-impl-2.4.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/usr/local/hadoop/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]

Logging initialized using configuration in jar:file:/usr/local/apache-hive-2.1.0-bin/lib/hive-common-2.1.0.jar!/hive-log4j2.properties Async: true
Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
hive> select current_date;
OK
2018-12-25
Time taken: 1.821 seconds, Fetched: 1 row(s)
hive> select current_timstamp;
FAILED: SemanticException [Error 10004]: Line 1:7 Invalid table alias or column reference 'current_timstamp': (possible column names are: )
hive> select current_timestamp;
OK
2018-12-25 12:46:18.401
Time taken: 0.231 seconds, Fetched: 1 row(s)
hive> select date_format(current_date,YYYY);
FAILED: SemanticException [Error 10004]: Line 1:32 Invalid table alias or column reference 'YYYY': (possible column names are: )
hive> select date_format(current_date,'y');
OK
2018
Time taken: 0.21 seconds, Fetched: 1 row(s)
hive> select date_format(current_date,'m');
OK
0
Time taken: 0.093 seconds, Fetched: 1 row(s)
hive> select date_format(current_date,'d');
OK
25
Time taken: 0.14 seconds, Fetched: 1 row(s)
hive> select date_format(current_date,'D');
OK
359
Time taken: 0.204 seconds, Fetched: 1 row(s)
hive> select day(current_date);
OK
25
Time taken: 0.125 seconds, Fetched: 1 row(s)
hive> select dayofmonth(current_date);
OK
25
Time taken: 0.204 seconds, Fetched: 1 row(s)
