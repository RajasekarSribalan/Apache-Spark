Let us get into details of By Key ranking

 Read data from HDFS
 Convert data into paired RDD using map
 Group data into key and array of values using groupByKey
 Apply flatMap and process the array of values to get data as per ranking requirements

*** Group data – groupByKey

 //Problem statement is get top 10 priced products within each category

scala> // Ranking - Get top N priced products with in each product category

scala> val products = sc.textFile("/public/retail_db/products")
products: org.apache.spark.rdd.RDD[String] = /public/retail_db/products MapPartitionsRDD[1] at textFile at <console>:24

scala> val productsMap = products.
     |   filter(product => product.split(",")(4) != "").
     | map(product => (product.split(",")(1).toInt, product))
productsMap: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[3] at map at <console>:27

scala> val productsGroupByCategory = productsMap.groupByKey
18/07/28 14:39:22 INFO FileInputFormat: Total input paths to process : 1
productsGroupByCategory: org.apache.spark.rdd.RDD[(Int, Iterable[String])] = ShuffledRDD[4] at groupByKey at <console>:25

scala> productsGroupByCategory.take(10).foreach(println)

(34,CompactBuffer(741,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 742,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 743,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 744,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 745,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 746,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 747,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 748,34,Ogio City Turf Golf Shoes,,129.99,http://images.acmesports.sports/Ogio+City+Turf+Golf+Shoes, 749,34,Ogio City Turf Golf Shoes,,129.99,http://images.acmesports.sports/Ogio+City+Turf+Golf+Shoes, 750,34,Ogio City Turf Golf Shoes,,129.99,http://images.acmesports.sports/Ogio+City+Turf+Golf+Shoes, 751,34,Ogio Sport Golf Shoes,,99.99,http://images.acmesports.sports/Ogio+Sport+Golf+Shoes, 752,34,Ogio Sport Golf Shoes,,99.99,http://images.acmesports.sports/Ogio+Sport+Golf+Shoes, 753,34,Ogio Sport Golf Shoes,,99.99,http://images.acmesports.sports/Ogio+Sport+Golf+Shoes, 754,34,TRUE linkswear Lyt Dry Golf Shoes,,149.99,http://images.acmesports.sports/TRUE+linkswear+Lyt+Dry+Golf+Shoes, 755,34,TRUE linkswear Lyt Dry Golf Shoes,,149.99,http://images.acmesports.sports/TRUE+linkswear+Lyt+Dry+Golf+Shoes, 756,34,TRUE linkswear Lyt Dry Golf Shoes,,149.99,http://images.acmesports.sports/TRUE+linkswear+Lyt+Dry+Golf+Shoes, 757,34,TRUE linkswear Vegas Golf Shoes,,99.99,http://images.acmesports.sports/TRUE+linkswear+Vegas+Golf+Shoes, 758,34,TRUE linkswear Vegas Golf Shoes,,99.99,http://images.acmesports.sports/TRUE+linkswear+Vegas+Golf+Shoes, 759,34,Nike Lunarwaverly Golf Shoes,,139.99,http://images.acmesports.sports/Nike+Lunarwaverly+Golf+Shoes, 760,34,Nike Lunarwaverly Golf Shoes,,139.99,http://images.acmesports.sports/Nike+Lunarwaverly+Golf+Shoes, 761,34,Nike Lunarwaverly Golf Shoes,,139.99,http://images.acmesports.sports/Nike+Lunarwaverly+Golf+Shoes, 762,34,Nike Lunarwaverly Golf Shoes,,139.99,http://images.acmesports.sports/Nike+Lunarwaverly+Golf+Shoes, 763,34,PING Golf Shoe Bag,,34.99,http://images.acmesports.sports/PING+Golf+Shoe+Bag, 764,34,Nike Lunar Mount Royal Golf Shoes,,99.99,http://images.acmesports.sports/Nike+Lunar+Mount+Royal+Golf+Shoes))
(52,CompactBuffer(1154,52,"Reebok Men's Chicago Blackhawks Patrick Kane ",,170.0,http://images.acmesports.sports/Reebok+Men%27s+Chicago+Blackhawks+Patrick+Kane+%2388+Home+Red..., 1155,52,$10 Gift Card,,10.0,http://images.acmesports.sports/%2410+Gift+Card, 1156,52,Reebok Men's Boston Bruins Patrice Bergeron #,,170.0,http://images.acmesports.sports/Reebok+Men%27s+Boston+Bruins+Patrice+Bergeron+%2337+Home+Black..., 1157,52,Reebok Men's Chicago Blackhawks Jonathan Toew,,170.0,http://images.acmesports.sports/Reebok+Men%27s+Chicago+Blackhawks+Jonathan+Toews+%2319+Home..., 1158,52,Reebok Men's Chicago Blackhawks Jonathan Toew,,170.0,http://images.acmesports.sports/Reebok+Men%27s+Chicago+Blackhawks+Jonathan+Toews+%2319+Home..., 1159,52,"Reebok Youth Chicago Blackhawks Patrick Kane ",,65.0,http://images.acmesports.sports/Reebok+Youth+Chicago+Blackhawks+Patrick+Kane+%2388+Home+Red..., 1160,52,Reebok Women's Chicago Blackhawks Patrick Kan,,130.0,http://images.acmesports.sports/Reebok+Women%27s+Chicago+Blackhawks+Patrick+Kane+%2388+Home..., 1161,52,Reebok Men's Detroit Red Wings 2014 NHL Cente,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Detroit+Red+Wings+2014+NHL+Center+Ice..., 1162,52,Reebok Men's Minnesota Wild 2014 NHL Center I,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Minnesota+Wild+2014+NHL+Center+Ice+Collection..., 1163,52,Reebok Men's Dallas Stars 2014 NHL Center Ice,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Dallas+Stars+2014+NHL+Center+Ice+Collection..., 1164,52,Reebok Men's Buffalo Sabres 2014 NHL Center I,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Buffalo+Sabres+2014+NHL+Center+Ice+Collection..., 1165,52,Reebok Men's Nashville Predators 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Nashville+Predators+2014+NHL+Center+Ice..., 1166,52,Reebok Men's Pittsburgh Penguins 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Pittsburgh+Penguins+2014+NHL+Center+Ice..., 1167,52,Reebok Men's Florida Panthers 2014 NHL Center,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Florida+Panthers+2014+NHL+Center+Ice+Collection..., 1168,52,Reebok Men's Toronto Maple Leafs 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Toronto+Maple+Leafs+2014+NHL+Center+Ice..., 1169,52,Reebok Men's Los Angeles Kings 2014 NHL Cente,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Los+Angeles+Kings+2014+NHL+Center+Ice..., 1170,52,Reebok Men's Carolina Hurricanes 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Carolina+Hurricanes+2014+NHL+Center+Ice..., 1171,52,Reebok Men's Philadelphia Flyers 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Philadelphia+Flyers+2014+NHL+Center+Ice..., 1172,52,Reebok Men's Washington Capitals 2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Washington+Capitals+2014+NHL+Center+Ice..., 1173,52,Reebok Men's Vancouver Canucks 2014 NHL Cente,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Vancouver+Canucks+2014+NHL+Center+Ice..., 1174,52,Reebok Men's Montreal Canadiens 2014 NHL Cent,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Montreal+Canadiens+2014+NHL+Center+Ice..., 1175,52,Reebok Men's Boston Bruins 2014 NHL Center Ic,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Boston+Bruins+2014+NHL+Center+Ice+Collection..., 1176,52,Reebok Men's Colorado Avalanche  2014 NHL Cen,,26.0,http://images.acmesports.sports/Reebok+Men%27s+Colorado+Avalanche++2014+NHL+Center+Ice..., 1177,52,Antigua Women's 2014 NHL Stanley Cup Champion,,54.99,http://images.acmesports.sports/Antigua+Women%27s+2014+NHL+Stanley+Cup+Champions+Los+Angeles...))
(56,CompactBuffer(1250,56,Nike Men's USA White Home Stadium Soccer Jers,,90.0,http://images.acmesports.sports/Nike+Men%27s+USA+White+Home+Stadium+Soccer+Jersey, 1251,56,Nike Youth USA Away Stadium Replica Soccer Je,,75.0,http://images.acmesports.sports/Nike+Youth+USA+Away+Stadium+Replica+Soccer+Jersey, 1252,56,adidas Brazuca 2014 Top Glider Soccer Ball,,29.99,http://images.acmesports.sports/adidas+Brazuca+2014+Top+Glider+Soccer+Ball, 1253,56,Nike Men's USA Away Stadium Replica Soccer Je,,90.0,http://images.acmesports.sports/Nike+Men%27s+USA+Away+Stadium+Replica+Soccer+Jersey, 1254,56,adidas Men's Germany Home Soccer Jersey,,90.0,http://images.acmesports.sports/adidas+Men%27s+Germany+Home+Soccer+Jersey, 1255,56,adidas Brazuca 2014 Top Repliqué Soccer Ball,,39.99,http://images.acmesports.sports/adidas+Brazuca+2014+Top+Repliqu%C3%A9+Soccer+Ball, 1256,56,adidas Brazuca 2014 Official Match Ball,,159.99,http://images.acmesports.sports/adidas+Brazuca+2014+Official+Match+Ball, 1257,56,adidas Men's Germany Black/Red Away Match Soc,,90.0,http://images.acmesports.sports/adidas+Men%27s+Germany+Black%2FRed+Away+Match+Soccer+Jersey, 1258,56,adidas Men's Mexico Home Soccer Jersey,,90.0,http://images.acmesports.sports/adidas+Men%27s+Mexico+Home+Soccer+Jersey, 1259,56,adidas Brazuca Final Rio Official Match Ball,,159.99,http://images.acmesports.sports/adidas+Brazuca+Final+Rio+Official+Match+Ball, 1260,56,Nike Men's USA Soccer Navy Authentic Polo,,70.0,http://images.acmesports.sports/Nike+Men%27s+USA+Soccer+Navy+Authentic+Polo, 1261,56,adidas Brazuca Final Rio Top Glider Soccer Ba,,29.99,http://images.acmesports.sports/adidas+Brazuca+Final+Rio+Top+Glider+Soccer+Ball, 1262,56,adidas Brazuca 2014 Mini Soccer Ball,,9.99,http://images.acmesports.sports/adidas+Brazuca+2014+Mini+Soccer+Ball, 1263,56,adidas Men's Germany Away Replica Black Top,,50.0,http://images.acmesports.sports/adidas+Men%27s+Germany+Away+Replica+Black+Top, 1264,56,adidas Men's Argentina Home Soccer Jersey,,90.0,http://images.acmesports.sports/adidas+Men%27s+Argentina+Home+Soccer+Jersey, 1265,56,Nike USA 2014 World Cup Red/White/Blue Scarf,,30.0,http://images.acmesports.sports/Nike+USA+2014+World+Cup+Red%2FWhite%2FBlue+Scarf, 1266,56,Nike Men's USA Soccer Grey Training Top,,55.0,http://images.acmesports.sports/Nike+Men%27s+USA+Soccer+Grey+Training+Top, 1267,56,adidas Men's Mexico Red Away Soccer Jersey,,90.0,http://images.acmesports.sports/adidas+Men%27s+Mexico+Red+Away+Soccer+Jersey, 1268,56,adidas Youth Germany Home Soccer Jersey,,70.0,http://images.acmesports.sports/adidas+Youth+Germany+Home+Soccer+Jersey, 1269,56,Nike Men's Netherlands Orange Home Stadium So,,90.0,http://images.acmesports.sports/Nike+Men%27s+Netherlands+Orange+Home+Stadium+Soccer+Jersey, 1270,56,adidas Men's Germany Black Crest Away Tee,,25.0,http://images.acmesports.sports/adidas+Men%27s+Germany+Black+Crest+Away+Tee, 1271,56,Nike Men's USA Soccer Red Authentic Polo,,70.0,http://images.acmesports.sports/Nike+Men%27s+USA+Soccer+Red+Authentic+Polo, 1272,56,Nike Men's USA Red Core Type T-Shirt,,28.0,http://images.acmesports.sports/Nike+Men%27s+USA+Red+Core+Type+T-Shirt, 1273,56,Nike Men's Netherlands Orange Core Crest T-Sh,,28.0,http://images.acmesports.sports/Nike+Men%27s+Netherlands+Orange+Core+Crest+T-Shirt))
(4,CompactBuffer(49,4,Diamondback Adult Sorrento Mountain Bike 2014,,299.98,http://images.acmesports.sports/Diamondback+Adult+Sorrento+Mountain+Bike+2014, 50,4,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy, 51,4,MAC Sports Collapsible Wagon,,69.99,http://images.acmesports.sports/MAC+Sports+Collapsible+Wagon, 52,4,Easton Mako Youth Bat 2014 (-11),,249.97,http://images.acmesports.sports/Easton+Mako+Youth+Bat+2014+%28-11%29, 53,4,adidas Brazuca 2014 Top Glider Soccer Ball,,29.99,http://images.acmesports.sports/adidas+Brazuca+2014+Top+Glider+Soccer+Ball, 54,4,Nike+ Fuelband SE,,99.0,http://images.acmesports.sports/Nike%2B+Fuelband+SE, 55,4,adidas Brazuca 2014 Top Repliqué Soccer Ball,,39.99,http://images.acmesports.sports/adidas+Brazuca+2014+Top+Repliqu%C3%A9+Soccer+Ball, 56,4,Fitbit Flex Wireless Activity & Sleep Wristba,,99.95,http://images.acmesports.sports/Fitbit+Flex+Wireless+Activity+%26+Sleep+Wristband, 57,4,"Nike Women's Pro Core 3"" Compression Shorts",,28.0,http://images.acmesports.sports/Nike+Women%27s+Pro+Core+3%22+Compression+Shorts, 58,4,Diamondback Boys' Insight 24 Performance Hybr,,299.99,http://images.acmesports.sports/Diamondback+Boys%27+Insight+24+Performance+Hybrid+Bike+2014, 59,4,adidas Brazuca 2014 Official Match Ball,,159.99,http://images.acmesports.sports/adidas+Brazuca+2014+Official+Match+Ball, 60,4,SOLE E25 Elliptical,,999.99,http://images.acmesports.sports/SOLE+E25+Elliptical, 61,4,Diamondback Girls' Clarity 24 Hybrid Bike 201,,299.99,http://images.acmesports.sports/Diamondback+Girls%27+Clarity+24+Hybrid+Bike+2014, 62,4,Easton XL1 Youth Bat 2014 (-10),,179.97,http://images.acmesports.sports/Easton+XL1+Youth+Bat+2014+%28-10%29, 63,4,Fitness Gear 300 lb Olympic Weight Set,,209.99,http://images.acmesports.sports/Fitness+Gear+300+lb+Olympic+Weight+Set, 64,4,Nike Women's Pro Victory Compression Bra,,21.99,http://images.acmesports.sports/Nike+Women%27s+Pro+Victory+Compression+Bra, 65,4,Quik Shade Summit SX170 10 FT. x 10 FT. Canop,,199.99,http://images.acmesports.sports/Quik+Shade+Summit+SX170+10+FT.+x+10+FT.+Canopy, 66,4,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill, 67,4,Kijaro Dual Lock Chair,,29.99,http://images.acmesports.sports/Kijaro+Dual+Lock+Chair, 68,4,Diamondback Adult Outlook Mountain Bike 2014,,309.99,http://images.acmesports.sports/Diamondback+Adult+Outlook+Mountain+Bike+2014, 69,4,Easton S1 Youth Bat 2014 (-12),,179.97,http://images.acmesports.sports/Easton+S1+Youth+Bat+2014+%28-12%29, 70,4,Elevation Training Mask 2.0,,79.99,http://images.acmesports.sports/Elevation+Training+Mask+2.0, 71,4,Diamondback Adult Response XE Mountain Bike 2,,349.98,http://images.acmesports.sports/Diamondback+Adult+Response+XE+Mountain+Bike+2014, 72,4,Quest 12' x 12' Dome Canopy,,149.99,http://images.acmesports.sports/Quest+12%27+x+12%27+Dome+Canopy))
(16,CompactBuffer(337,16,Fitness Gear 300 lb Olympic Weight Set,,209.99,http://images.acmesports.sports/Fitness+Gear+300+lb+Olympic+Weight+Set, 338,16,Nike Men's Fingertrap Max Training Shoe,,124.99,http://images.acmesports.sports/Nike+Men%27s+Fingertrap+Max+Training+Shoe, 339,16,Elevation Training Mask 2.0,,79.99,http://images.acmesports.sports/Elevation+Training+Mask+2.0, 340,16,PRIMED 12' x 6' Instant Soccer Goal,,149.99,http://images.acmesports.sports/PRIMED+12%27+x+6%27+Instant+Soccer+Goal, 341,16,Fitness Gear Pro Utility Bench,,179.99,http://images.acmesports.sports/Fitness+Gear+Pro+Utility+Bench, 342,16,SKLZ Quickster 12' x 6' Portable Soccer Goal,,149.99,http://images.acmesports.sports/SKLZ+Quickster+12%27+x+6%27+Portable+Soccer+Goal, 343,16,Teeter Hang Ups NXT-S Inversion Table,,299.99,http://images.acmesports.sports/Teeter+Hang+Ups+NXT-S+Inversion+Table, 344,16,Under Armour Men's Ignite Camo II Slide,,34.99,http://images.acmesports.sports/Under+Armour+Men%27s+Ignite+Camo+II+Slide, 345,16,Fitness Gear Pro Olympic Bench,,249.99,http://images.acmesports.sports/Fitness+Gear+Pro+Olympic+Bench, 346,16,Fitness Gear Pro Half Rack,,349.99,http://images.acmesports.sports/Fitness+Gear+Pro+Half+Rack, 347,16,adidas Brazuca Final Rio Top Glider Soccer Ba,,29.99,http://images.acmesports.sports/adidas+Brazuca+Final+Rio+Top+Glider+Soccer+Ball, 348,16,McDavid HEX Extended Leg Sleeves,,29.99,http://images.acmesports.sports/McDavid+HEX+Extended+Leg+Sleeves, 349,16,Franklin 12' x 6' Competition Steel Soccer Go,,119.99,http://images.acmesports.sports/Franklin+12%27+x+6%27+Competition+Steel+Soccer+Goal, 350,16,Nike Men's Comfort 2 Slide,,44.99,http://images.acmesports.sports/Nike+Men%27s+Comfort+2+Slide, 351,16,Jugs Complete Practice Travel Screen,,149.99,http://images.acmesports.sports/Jugs+Complete+Practice+Travel+Screen, 352,16,Under Armour Men's Ignite III Slide,,34.99,http://images.acmesports.sports/Under+Armour+Men%27s+Ignite+III+Slide, 353,16,Nike Men's Comfort 2 Slide,,44.99,http://images.acmesports.sports/Nike+Men%27s+Comfort+2+Slide, 354,16,Nike Men's Fingertrap Max Training Shoe,,124.99,http://images.acmesports.sports/Nike+Men%27s+Fingertrap+Max+Training+Shoe, 355,16,Nike Men's Free Trainer 5.0 Training Shoe,,99.99,http://images.acmesports.sports/Nike+Men%27s+Free+Trainer+5.0+Training+Shoe, 356,16,PRIMED 7' x 5' Soccer Trainer,,99.99,http://images.acmesports.sports/PRIMED+7%27+x+5%27+Soccer+Trainer, 357,16,Under Armour Kids' Ignite III Slide,,27.99,http://images.acmesports.sports/Under+Armour+Kids%27+Ignite+III+Slide, 358,16,Reebok Women's Solid Classic Tank Swimsuit,,64.99,http://images.acmesports.sports/Reebok+Women%27s+Solid+Classic+Tank+Swimsuit, 359,16,Nike Men's Free TR 5.0 TB Training Shoe,,99.99,http://images.acmesports.sports/Nike+Men%27s+Free+TR+5.0+TB+Training+Shoe, 360,16,Under Armour Women's Ignite VI Slide,,31.99,http://images.acmesports.sports/Under+Armour+Women%27s+Ignite+VI+Slide))
(22,CompactBuffer(477,22,Nike Women's Tempo Shorts,,30.0,http://images.acmesports.sports/Nike+Women%27s+Tempo+Shorts, 478,22,Nike Women's Tempo Shorts,,30.0,http://images.acmesports.sports/Nike+Women%27s+Tempo+Shorts, 479,22,Brooks Women's Adrenaline GTS 13 Running Shoe,,89.99,http://images.acmesports.sports/Brooks+Women%27s+Adrenaline+GTS+13+Running+Shoe, 480,22,Nike+ Fuelband SE,,99.0,http://images.acmesports.sports/Nike%2B+Fuelband+SE, 481,22,"Top Flite Women's XL 12-Piece Complete Set - ",,179.98,http://images.acmesports.sports/Top+Flite+Women%27s+XL+12-Piece+Complete+Set+-+%28Graphite%29, 482,22,Fitbit Flex Wireless Activity & Sleep Wristba,,99.95,http://images.acmesports.sports/Fitbit+Flex+Wireless+Activity+%26+Sleep+Wristband, 483,22,Nike Women's Tempo Shorts,,30.0,http://images.acmesports.sports/Nike+Women%27s+Tempo+Shorts, 484,22,Nike Men's Free 5.0+ Running Shoe,,99.99,http://images.acmesports.sports/Nike+Men%27s+Free+5.0%2B+Running+Shoe, 485,22,"Nike Women's Pro Core 3"" Compression Shorts",,28.0,http://images.acmesports.sports/Nike+Women%27s+Pro+Core+3%22+Compression+Shorts, 486,22,Coleman River Gorge 6 Person Dome Tent,,79.98,http://images.acmesports.sports/Coleman+River+Gorge+6+Person+Dome+Tent, 487,22,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat, 488,22,SOLE E25 Elliptical,,999.99,http://images.acmesports.sports/SOLE+E25+Elliptical, 489,22,Nike Kids' Grade School KD VI Basketball Shoe,,99.99,http://images.acmesports.sports/Nike+Kids%27+Grade+School+KD+VI+Basketball+Shoe, 490,22,Nike Women's Free 4.0 Running Shoe,,89.99,http://images.acmesports.sports/Nike+Women%27s+Free+4.0+Running+Shoe, 491,22,Under Armour Women's Micro G Skulpt Running S,,54.97,http://images.acmesports.sports/Under+Armour+Women%27s+Micro+G+Skulpt+Running+Shoe, 492,22,Nike Men's Free 5.0 Running Shoe,,99.99,http://images.acmesports.sports/Nike+Men%27s+Free+5.0+Running+Shoe, 493,22,Brooks Women's Ghost 6 Running Shoe,,89.99,http://images.acmesports.sports/Brooks+Women%27s+Ghost+6+Running+Shoe, 494,22,Nike Women's Pro Victory Compression Bra,,21.99,http://images.acmesports.sports/Nike+Women%27s+Pro+Victory+Compression+Bra, 495,22,Slazenger Women's Ava Sleeveless Fashion Golf,,32.0,http://images.acmesports.sports/Slazenger+Women%27s+Ava+Sleeveless+Fashion+Golf+Polo, 496,22,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill, 497,22,Nike Women's Free 5.0+ Running Shoe,,99.99,http://images.acmesports.sports/Nike+Women%27s+Free+5.0%2B+Running+Shoe, 498,22,Brooks Men's Adrenaline GTS 13 Running Shoe,,89.99,http://images.acmesports.sports/Brooks+Men%27s+Adrenaline+GTS+13+Running+Shoe, 499,22,Brooks Women's Ghost 6 Running Shoe,,89.99,http://images.acmesports.sports/Brooks+Women%27s+Ghost+6+Running+Shoe, 500,22,Kijaro Dual Lock Chair,,29.99,http://images.acmesports.sports/Kijaro+Dual+Lock+Chair))
(54,CompactBuffer(1202,54,Schutt Youth Recruit Hybrid Custom Football H,,99.99,http://images.acmesports.sports/Schutt+Youth+Recruit+Hybrid+Custom+Football+Helmet+2014, 1203,54,Nike Adult Pro Combat Hyperstrong Girdle,,63.99,http://images.acmesports.sports/Nike+Adult+Pro+Combat+Hyperstrong+Girdle, 1204,54,Nike Adult Pro Combat Hyperstrong 3/4 Girdle,,87.99,http://images.acmesports.sports/Nike+Adult+Pro+Combat+Hyperstrong+3%2F4+Girdle, 1205,54,Schutt Youth Vengeance DCT Hybrid Custom Foot,,129.99,http://images.acmesports.sports/Schutt+Youth+Vengeance+DCT+Hybrid+Custom+Football+Helmet..., 1206,54,Schutt Adult Integrated Football Pants,,39.99,http://images.acmesports.sports/Schutt+Adult+Integrated+Football+Pants, 1207,54,Nike Youth Pro Combat Hyperstrong 4 Pad Footb,,51.99,http://images.acmesports.sports/Nike+Youth+Pro+Combat+Hyperstrong+4+Pad+Football+Shirt, 1208,54,Schutt Youth Vengeance DCT Hybrid+ Custom Foo,,149.99,http://images.acmesports.sports/Schutt+Youth+Vengeance+DCT+Hybrid%2B+Custom+Football+Helmet..., 1209,54,Nike Youth Pro Combat Hyperstrong Girdle,,55.99,http://images.acmesports.sports/Nike+Youth+Pro+Combat+Hyperstrong+Girdle, 1210,54,Schutt Youth AiR XP Pro Custom Football Helme,,199.99,http://images.acmesports.sports/Schutt+Youth+AiR+XP+Pro+Custom+Football+Helmet+2014, 1211,54,Schutt Youth XP Hybrid Custom Football Helmet,,99.99,http://images.acmesports.sports/Schutt+Youth+XP+Hybrid+Custom+Football+Helmet+2014, 1212,54,Nike Men's Pro Combat Hyperstrong 4 Pad Footb,,63.99,http://images.acmesports.sports/Nike+Men%27s+Pro+Combat+Hyperstrong+4+Pad+Football+Shirt, 1213,54,Riddell Youth Power Rib Shirt,,54.99,http://images.acmesports.sports/Riddell+Youth+Power+Rib+Shirt, 1214,54,Schutt Youth Vengeance DCT Custom Football He,,299.99,http://images.acmesports.sports/Schutt+Youth+Vengeance+DCT+Custom+Football+Helmet+2014, 1215,54,Riddell Adult Power 7-Pad Girdle,,79.99,http://images.acmesports.sports/Riddell+Adult+Power+7-Pad+Girdle, 1216,54,Schutt Youth Vengeance DCT Custom Football He,,299.99,http://images.acmesports.sports/Schutt+Youth+Vengeance+DCT+Custom+Football+Helmet, 1217,54,Nike Youth Pro Combat Hyperstrong 4 Pad Footb,,51.99,http://images.acmesports.sports/Nike+Youth+Pro+Combat+Hyperstrong+4+Pad+Football+Shirt, 1218,54,Schutt Youth Integrated Football Pants,,34.99,http://images.acmesports.sports/Schutt+Youth+Integrated+Football+Pants, 1219,54,Riddell Adult Power Girdle,,49.99,http://images.acmesports.sports/Riddell+Adult+Power+Girdle, 1220,54,Riddell Youth Power Girdle,,44.99,http://images.acmesports.sports/Riddell+Youth+Power+Girdle, 1221,54,Cutters Adult C-TACK Revolution Receiver Glov,,34.99,http://images.acmesports.sports/Cutters+Adult+C-TACK+Revolution+Receiver+Gloves, 1222,54,Under Armour Adult Gameday Armour 5 Pad Girdl,,55.99,http://images.acmesports.sports/Under+Armour+Adult+Gameday+Armour+5+Pad+Girdle, 1223,54,Schutt Varsity Super-Pro STG Specialty Facema,,69.99,http://images.acmesports.sports/Schutt+Varsity+Super-Pro+STG+Specialty+Facemask, 1224,54,Schutt XV Flex Skill Shield Football Shoulder,,179.99,http://images.acmesports.sports/Schutt+XV+Flex+Skill+Shield+Football+Shoulder+Pads, 1225,54,Nike Adult Pro Combat Hyperstrong Girdle,,63.99,http://images.acmesports.sports/Nike+Adult+Pro+Combat+Hyperstrong+Girdle))
(46,CompactBuffer(1010,46,DBX Vector Series Men's Nylon Life Vest,,19.98,http://images.acmesports.sports/DBX+Vector+Series+Men%27s+Nylon+Life+Vest, 1011,46,Old Town Canoe Saranac 146 Canoe,,499.99,http://images.acmesports.sports/Old+Town+Canoe+Saranac+146+Canoe, 1012,46,Pelican Trailblazer 100 Angler Fishing Kayak,,299.99,http://images.acmesports.sports/Pelican+Trailblazer+100+Angler+Fishing+Kayak, 1013,46,Perception Sport Swifty Deluxe 9.5 Kayak,,349.99,http://images.acmesports.sports/Perception+Sport+Swifty+Deluxe+9.5+Kayak, 1014,46,O'Brien Men's Neoprene Life Vest,,49.98,http://images.acmesports.sports/O%27Brien+Men%27s+Neoprene+Life+Vest, 1015,46,GoPro HERO3+ Black Edition Camera,,399.99,http://images.acmesports.sports/GoPro+HERO3%2B+Black+Edition+Camera, 1016,46,Field & Stream 12' Eagle Run Kayak,,549.99,http://images.acmesports.sports/Field+%26+Stream+12%27+Eagle+Run+Kayak, 1017,46,DBX Vector Series Women's Nylon Life Vest,,19.98,http://images.acmesports.sports/DBX+Vector+Series+Women%27s+Nylon+Life+Vest, 1018,46,Coleman Scanoe Canoe,,399.99,http://images.acmesports.sports/Coleman+Scanoe+Canoe, 1019,46,O'Brien Youth Neoprene Life Vest,,44.98,http://images.acmesports.sports/O%27Brien+Youth+Neoprene+Life+Vest, 1020,46,Field & Stream Eagle Talon Kayak,,549.99,http://images.acmesports.sports/Field+%26+Stream+Eagle+Talon+Kayak, 1021,46,Old Town Trip 10 Angler Deluxe Kayak,,499.99,http://images.acmesports.sports/Old+Town+Trip+10+Angler+Deluxe+Kayak, 1022,46,O'Brien Women's Neoprene Life Vest,,49.98,http://images.acmesports.sports/O%27Brien+Women%27s+Neoprene+Life+Vest, 1023,46,Quest Pioneer Adjustable Aluminum Kayak Paddl,,29.99,http://images.acmesports.sports/Quest+Pioneer+Adjustable+Aluminum+Kayak+Paddle, 1024,46,Columbia Women's Sandy River Shorts,,21.99,http://images.acmesports.sports/Columbia+Women%27s+Sandy+River+Shorts, 1025,46,Future Beach Trophy 126 Kayak,,369.99,http://images.acmesports.sports/Future+Beach+Trophy+126+Kayak, 1026,46,Quantum Smoke PT Spinning Reels,,119.99,http://images.acmesports.sports/Quantum+Smoke+PT+Spinning+Reels, 1027,46,DBX Vector Series Youth Nylon Life Vest,,34.99,http://images.acmesports.sports/DBX+Vector+Series+Youth+Nylon+Life+Vest, 1028,46,YETI Tundra 65 Chest Cooler,,399.99,http://images.acmesports.sports/YETI+Tundra+65+Chest+Cooler, 1029,46,DBX 4 Buckle Nylon Life Vest,,39.99,http://images.acmesports.sports/DBX+4+Buckle+Nylon+Life+Vest, 1030,46,Perception Sport Striker 11.5 Angler Kayak,,499.99,http://images.acmesports.sports/Perception+Sport+Striker+11.5+Angler+Kayak, 1031,46,YETI Roadie 20 Chest Cooler,,249.99,http://images.acmesports.sports/YETI+Roadie+20+Chest+Cooler, 1032,46,Sun Dolphin Sun Slider 5-Seated Pedal Boat wi,,499.99,http://images.acmesports.sports/Sun+Dolphin+Sun+Slider+5-Seated+Pedal+Boat+with+Canopy, 1033,46,YETI Tundra 45 Chest Cooler,,349.99,http://images.acmesports.sports/YETI+Tundra+45+Chest+Cooler))
(48,CompactBuffer(1058,48,Lifetime Freestyle XL Stand-Up Paddle Board,,399.99,http://images.acmesports.sports/Lifetime+Freestyle+XL+Stand-Up+Paddle+Board, 1059,48,Pelican Maverick 100X Kayak,,349.99,http://images.acmesports.sports/Pelican+Maverick+100X+Kayak, 1060,48,DBX Vector Series Men's Nylon Life Vest,,19.98,http://images.acmesports.sports/DBX+Vector+Series+Men%27s+Nylon+Life+Vest, 1061,48,Old Town Canoe Saranac 146 Canoe,,499.99,http://images.acmesports.sports/Old+Town+Canoe+Saranac+146+Canoe, 1062,48,Pelican Vortex 80DLX Kayak,,199.99,http://images.acmesports.sports/Pelican+Vortex+80DLX+Kayak, 1063,48,Pelican Trailblazer 100 Angler Fishing Kayak,,299.99,http://images.acmesports.sports/Pelican+Trailblazer+100+Angler+Fishing+Kayak, 1064,48,Pelican Trailblazer 100 Kayak,,229.99,http://images.acmesports.sports/Pelican+Trailblazer+100+Kayak, 1065,48,Perception Sport Swifty Deluxe 9.5 Kayak,,349.99,http://images.acmesports.sports/Perception+Sport+Swifty+Deluxe+9.5+Kayak, 1066,48,O'Brien Men's Neoprene Life Vest,,49.98,http://images.acmesports.sports/O%27Brien+Men%27s+Neoprene+Life+Vest, 1067,48,Field & Stream 12' Eagle Run Kayak,,549.99,http://images.acmesports.sports/Field+%26+Stream+12%27+Eagle+Run+Kayak, 1068,48,DBX Vector Series Women's Nylon Life Vest,,19.98,http://images.acmesports.sports/DBX+Vector+Series+Women%27s+Nylon+Life+Vest, 1069,48,"Tiga 11'4"" Stand-Up Paddle Board",,799.99,http://images.acmesports.sports/Tiga+11%274%22+Stand-Up+Paddle+Board, 1070,48,Coleman Scanoe Canoe,,399.99,http://images.acmesports.sports/Coleman+Scanoe+Canoe, 1071,48,Pelican Apex 100 Kayak,,229.99,http://images.acmesports.sports/Pelican+Apex+100+Kayak, 1072,48,O'Brien Youth Neoprene Life Vest,,44.98,http://images.acmesports.sports/O%27Brien+Youth+Neoprene+Life+Vest, 1073,48,Pelican Sunstream 100 Kayak,,199.99,http://images.acmesports.sports/Pelican+Sunstream+100+Kayak, 1074,48,Field & Stream Eagle Talon Kayak,,549.99,http://images.acmesports.sports/Field+%26+Stream+Eagle+Talon+Kayak, 1075,48,Old Town Trip 10 Angler Deluxe Kayak,,499.99,http://images.acmesports.sports/Old+Town+Trip+10+Angler+Deluxe+Kayak, 1076,48,Future Beach Spirit 120 Kayak,,269.99,http://images.acmesports.sports/Future+Beach+Spirit+120+Kayak, 1077,48,O'Brien Women's Neoprene Life Vest,,49.98,http://images.acmesports.sports/O%27Brien+Women%27s+Neoprene+Life+Vest, 1078,48,Quest Pioneer Adjustable Aluminum Kayak Paddl,,29.99,http://images.acmesports.sports/Quest+Pioneer+Adjustable+Aluminum+Kayak+Paddle, 1079,48,Future Beach Trophy 126 Kayak,,369.99,http://images.acmesports.sports/Future+Beach+Trophy+126+Kayak, 1080,48,DBX Vector Series Youth Nylon Life Vest,,34.99,http://images.acmesports.sports/DBX+Vector+Series+Youth+Nylon+Life+Vest, 1081,48,Snap OnTop Solo Kayak,,399.99,http://images.acmesports.sports/Snap+OnTop+Solo+Kayak))
(30,CompactBuffer(645,30,Roxy Women's Steamer Long Sleeve Rash Guard,,68.0,http://images.acmesports.sports/Roxy+Women%27s+Steamer+Long+Sleeve+Rash+Guard, 646,30,Merrell Women's Grassbow Sport Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Grassbow+Sport+Hiking+Shoe, 647,30,Merrell Women's Siren Mid Waterproof Hiking B,,134.99,http://images.acmesports.sports/Merrell+Women%27s+Siren+Mid+Waterproof+Hiking+Boot, 648,30,Merrell Women's Siren Mid Waterproof Hiking B,,134.99,http://images.acmesports.sports/Merrell+Women%27s+Siren+Mid+Waterproof+Hiking+Boot, 649,30,Merrell Men's Chameleon Prime Stretch Realtre,,109.99,http://images.acmesports.sports/Merrell+Men%27s+Chameleon+Prime+Stretch+Realtree+Xtra+Hiking..., 650,30,"Merrell Men's Chameleon Prime Stretch Hiking ",,109.99,http://images.acmesports.sports/Merrell+Men%27s+Chameleon+Prime+Stretch+Hiking+Shoe, 651,30,Merrell Men's Chameleon Prime Stretch Realtre,,129.99,http://images.acmesports.sports/Merrell+Men%27s+Chameleon+Prime+Stretch+Realtree+Xtra..., 652,30,Merrell Women's Grassbow Sport Waterproof Hik,,129.99,http://images.acmesports.sports/Merrell+Women%27s+Grassbow+Sport+Waterproof+Hiking+Shoe, 653,30,Merrell Women's Grassbow Sport Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Grassbow+Sport+Hiking+Shoe, 654,30,Merrell Men's Moab Rover Waterproof Wide Hiki,,109.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Waterproof+Wide+Hiking+Shoe, 655,30,Merrell Men's Moab Rover Waterproof Wide Hiki,,109.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Waterproof+Wide+Hiking+Shoe, 656,30,Merrell Men's Moab Rover Waterproof Wide Hiki,,109.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Waterproof+Wide+Hiking+Shoe, 657,30,Merrell Women's Azura Wide Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Azura+Wide+Hiking+Shoe, 658,30,Merrell Women's Azura Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Azura+Hiking+Shoe, 659,30,Merrell Men's Moab Rover Waterproof Wide Hiki,,119.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Waterproof+Wide+Hiking+Shoe, 660,30,Merrell Men's Moab Rover Waterproof Hiking Sh,,119.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Waterproof+Hiking+Shoe, 661,30,Merrell Women's Azura Wide Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Azura+Wide+Hiking+Shoe, 662,30,Merrell Women's Azura Hiking Shoe,,99.99,http://images.acmesports.sports/Merrell+Women%27s+Azura+Hiking+Shoe, 663,30,"Merrell Men's Moab Rover Mid Waterproof Wide ",,139.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Mid+Waterproof+Wide+Hiking+Boot, 664,30,"Merrell Men's Moab Rover Mid Waterproof Wide ",,139.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Mid+Waterproof+Wide+Hiking+Boot, 665,30,Merrell Men's Moab Rover Mid Waterproof Hikin,,139.99,http://images.acmesports.sports/Merrell+Men%27s+Moab+Rover+Mid+Waterproof+Hiking+Boot, 666,30,Merrell Men's All Out Flash Trail Running Sho,,109.99,http://images.acmesports.sports/Merrell+Men%27s+All+Out+Flash+Trail+Running+Shoe, 667,30,Merrell Women's All Out Flash Trail Running S,,109.99,http://images.acmesports.sports/Merrell+Women%27s+All+Out+Flash+Trail+Running+Shoe, 66



*** From above returned data set ***** Scala APIs to get top N Prices

we can use first api to get first record from RDD.

scala> val a = productsGroupByCategory.first
a: (Int, Iterable[String]) = (34,CompactBuffer(741,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 742,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 743,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 744,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 745,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 746,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 747,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 748,34,Ogio City Turf Golf Shoes,,129.99,http://...

scala> val productsIterable = productsGroupByCategory.first._2
productsIterable: Iterable[String] = CompactBuffer(741,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 742,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 743,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 744,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 745,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 746,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 747,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 748,34,Ogio City Turf Golf Shoes,,129.99,htt...


scala> productsIterable.size
res1: Int = 24

scala> //Let see now how we can get top 5 prices

scala> //To get ,i have to convert the price as float and remove the duplicates AND TAKE TOP 5 PRICES.i CAN USE set TO REMOVE DUPLICATES

scala> val productPrices = product
productPrices   products   productsGroupByCategory   productsIterable   productsMap

scala> val productPrices = productsIte18/07/28 14:51:47 INFO ContextCleaner: Cleaned accumulator 78

                           productsIterable
productPrices: Iterable[String] = CompactBuffer(741,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 742,34,FootJoy GreenJoys Golf Shoes,,59.99,http://images.acmesports.sports/FootJoy+GreenJoys+Golf+Shoes, 743,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 744,34,Ogio Race Golf Shoes,,169.99,http://images.acmesports.sports/Ogio+Race+Golf+Shoes, 745,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 746,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 747,34,Ogio City Spiked Golf Shoes,,149.99,http://images.acmesports.sports/Ogio+City+Spiked+Golf+Shoes, 748,34,Ogio City Turf Golf Shoes,,129.99,http:/...

scala> val productPrices = productsIterable.map(p => p.split(",")(4).toFloat).toSet
productPrices: scala.collection.immutable.Set[Float] = Set(99.99, 169.99, 149.99, 59.99, 129.99, 34.99, 139.99)

scala> 

scala> val topNPrices = productPrices.toList.sortBy(p => -p).take(5)
topNPrices: List[Float] = List(169.99, 149.99, 139.99, 129.99, 99.99)

scala> //To sort we need to convert set to a list  bcoz we dont have api in set to sort

scala> val topNPrices = productPrices.toList.sortBy(p => +p).take(5)
topNPrices: List[Float] = List(34.99, 59.99, 99.99, 129.99, 139.99)

scala> val topNPrices = productPrices.toList.sortBy(p => p).take(5)
topNPrices: List[Float] = List(34.99, 59.99, 99.99, 129.99, 139.99)


*** Based on the above data set, now Scala APIs to get top N Priced Products

takeWhile vs Filter???


// Function to get top n priced products using Scala collections API

val products = sc.textFile("/public/retail_db/products")
val productsMap = products.
  filter(product => product.split(",")(4) != "").
  map(product => (product.split(",")(1).toInt, product))
val productsGroupByCategory = productsMap.groupByKey

def getTopNPricedProducts(productsIterable: Iterable[String], topN: Int): Iterable[String] = {
  val productPrices = productsIterable.map(p => p.split(",")(4).toFloat).toSet
  val topNPrices = productPrices.toList.sortBy(p => -p).take(topN)

  val productsSorted = productsIterable.toList.sortBy(product => -product.split(",")(4).toFloat)
  val minOfTopNPrices = topNPrices.min

  val topNPricedProducts = productsSorted.takeWhile(product => product.split(",")(4).toFloat >= minOfTopNPrices)

  topNPricedProducts
}

val productsIterable = productsGroupByCategory.first._2
getTopNPricedProducts(productsIterable, 3).foreach(println)



// Get top N priced products per category 

 Read data from HDFS
 Convert data into paired RDD using map
 Group data into key and array of values using groupByKey
 Define function to get top N priced products for a given category
 Invoke function as part of flatMap so that we can get top N priced products for all categories


// Ranking - Get top N priced products with in each product category

val products = sc.textFile("/public/retail_db/products")
val productsMap = products.
  filter(product => product.split(",")(4) != "").
  map(product => (product.split(",")(1).toInt, product))
val productsGroupByCategory = productsMap.groupByKey

def getTopNPricedProducts(productsIterable: Iterable[String], topN: Int): Iterable[String] = {
  val productPrices = productsIterable.map(p => p.split(",")(4).toFloat).toSet
  val topNPrices = productPrices.toList.sortBy(p => -p).take(topN)

  val productsSorted = productsIterable.toList.sortBy(product => -product.split(",")(4).toFloat)
  val minOfTopNPrices = topNPrices.min

  val topNPricedProducts = productsSorted.takeWhile(product => product.split(",")(4).toFloat >= minOfTopNPrices)

  topNPricedProducts
}

val top3PricedProductsPerCategory = productsGroupByCategory.flatMap(rec => getTopNPricedProducts(rec._2, 3))


