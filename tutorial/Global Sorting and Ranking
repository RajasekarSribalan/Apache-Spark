****** Global Sorting and Ranking  *********

Let us deep dive into global sorting and ranking

sortByKey – for sorting the data
Ranking
 	sortByKey and take
	takeOrdered
	top
takeOrdered and top are actions


Global Sorting – sortByKey

sortByKey([ascending], [numPartitions])	
	When called on a dataset of (K, V) pairs where K implements Ordered, returns a dataset of (K, V) pairs sorted by keys in ascending or descending order, as specified in the boolean ascending argument.

--By default all primitive types implement Ordered.
--For Custom type,we need to implement seperately



scala> 

scala> val products = sc.textFile("/public/retail_db/products")
products: org.apache.spark.rdd.RDD[String] = /public/retail_db/products MapPartitionsRDD[1] at textFile at <console>:24

scala> products.take(5).foreach(println)
1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy
2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat
3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet

scala> //Sort this data by category id

scala> products
res1: org.apache.spark.rdd.RDD[String] = /public/retail_db/products MapPartitionsRDD[1] at textFile at <console>:24

scala> //TO use sortBYKey, we need to tansform into Paris

scala> //TO use sortBYKey, we need to tansform into Pairs

scala> val productsMap = products.map(product => (products.split(",")(1).toInt, product)
     | )
<console>:25: error: value split is not a member of org.apache.spark.rdd.RDD[String]
       val productsMap = products.map(product => (products.split(",")(1).toInt, product)
                                                           ^

scala> val productsMap = products.map(product => (product.split(",")(1).toInt, product))
productsMap: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[2] at map at <console>:25

scala> productsMap.take(5).foreach(println)
(2,1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy)
(2,2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
(2,3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet)

scala> productsMap
res3: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[2] at map at <console>:25

scala> val productsSortedByCategoryId = productsMap.sortByKey(false)
productsSortedByCategoryId: org.apache.spark.rdd.RDD[(Int, String)] = ShuffledRDD[5] at sortByKey at <console>:25

scala> 

scala> productsSortedByCategoryId.take(5).foreach(println)
(59,1322,59,Nike Men's Cleveland Browns 'Money Manziel' T,,30.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+%27Money+Manziel%27+T-Shirt)
(59,1323,59,"Nike Men's Home Game Jersey Cleveland Browns ",,100.0,http://images.acmesports.sports/Nike+Men%27s+Home+Game+Jersey+Cleveland+Browns+Johnny+Manziel...)
(59,1324,59,Nike Men's Cleveland Browns Johnny Manziel 'M,,30.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+Johnny+Manziel+%27Money%27+T-Shirt)
(59,1325,59,Nike Johnny Football Camo Graphic T-Shirt,,30.0,http://images.acmesports.sports/Nike+Johnny+Football+Camo+Graphic+T-Shirt)
(59,1326,59,"Nike Youth Home Game Jersey Cleveland Browns ",,70.0,http://images.acmesports.sports/Nike+Youth+Home+Game+Jersey+Cleveland+Browns+Johnny+Manziel...)

scala> val productsSortedByCategoryId = productsMap.sortByKey(true)
productsSortedByCategoryId: org.apache.spark.rdd.RDD[(Int, String)] = ShuffledRDD[8] at sortByKey at <console>:25

scala> productsSortedByCategoryId.take(5).foreach(println)
(2,1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy)
(2,2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
(2,3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet)

scala> val productsSortedByCategoryId = productsMap.sortByKey()
productsSortedByCategoryId: org.apache.spark.rdd.RDD[(Int, String)] = ShuffledRDD[11] at sortByKey at <console>:25

scala> productsSortedByCategoryId.take(5).foreach(println)
(2,1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy)
(2,2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
(2,3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)
(2,5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet)

scala> 18/07/26 07:57:29 INFO ContextCleaner: Cleaned accumulator 234



scala> val productsMap = products.
     |  map(product => ((product.split(",")(1).toInt, -product.split(",")(4).toFloat), product))
productsMap: org.apache.spark.rdd.RDD[((Int, Float), String)] = MapPartitionsRDD[12] at map at <console>:26

scala> val productsSortedByCategoryId = productsMap.sortByKey(false)
18/07/26 08:22:20 INFO SparkContext: Starting job: sortByKey at <console>:25
18/07/26 08:22:20 INFO DAGScheduler: Got job 8 (sortByKey at <console>:25) with 2 output partitions
18/07/26 08:22:20 INFO DAGScheduler: Final stage: ResultStage 11 (sortByKey at <console>:25)
18/07/26 08:22:20 INFO DAGScheduler: Parents of final stage: List()
18/07/26 08:22:20 INFO DAGScheduler: Missing parents: List()
18/07/26 08:22:20 INFO DAGScheduler: Submitting ResultStage 11 (MapPartitionsRDD[14] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:22:20 INFO MemoryStore: Block broadcast_12 stored as values in memory (estimated size 3.9 KB, free 366.0 MB)
18/07/26 08:22:20 INFO MemoryStore: Block broadcast_12_piece0 stored as bytes in memory (estimated size 2.2 KB, free 366.0 MB)
18/07/26 08:22:20 INFO BlockManagerInfo: Added broadcast_12_piece0 in memory on 192.168.1.105:45155 (size: 2.2 KB, free: 366.3 MB)
18/07/26 08:22:20 INFO SparkContext: Created broadcast 12 from broadcast at DAGScheduler.scala:1039
18/07/26 08:22:20 INFO DAGScheduler: Submitting 2 missing tasks from ResultStage 11 (MapPartitionsRDD[14] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:22:20 INFO YarnScheduler: Adding task set 11.0 with 2 tasks
18/07/26 08:22:20 INFO TaskSetManager: Starting task 0.0 in stage 11.0 (TID 17, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:22:20 INFO BlockManagerInfo: Added broadcast_12_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.2 KB, free: 93.3 MB)
18/07/26 08:22:20 INFO TaskSetManager: Starting task 1.0 in stage 11.0 (TID 18, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7917 bytes)
18/07/26 08:22:20 WARN TaskSetManager: Lost task 0.0 in stage 11.0 (TID 17, raj-Lenovo-Y50-70, executor 1): java.lang.NumberFormatException: empty String
	at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1842)
	at sun.misc.FloatingDecimal.parseFloat(FloatingDecimal.java:122)
	at java.lang.Float.parseFloat(Float.java:451)
	at scala.collection.immutable.StringLike$class.toFloat(StringLike.scala:280)
	at scala.collection.immutable.StringOps.toFloat(StringOps.scala:29)
	at $line27.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$anonfun$1.apply(<console>:26)
	at $line27.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$anonfun$1.apply(<console>:26)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at org.apache.spark.util.random.SamplingUtils$.reservoirSampleAndCount(SamplingUtils.scala:58)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:303)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:301)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:109)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)

18/07/26 08:22:20 INFO TaskSetManager: Starting task 0.1 in stage 11.0 (TID 19, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:22:20 INFO TaskSetManager: Finished task 1.0 in stage 11.0 (TID 18) in 20 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:22:20 INFO TaskSetManager: Lost task 0.1 in stage 11.0 (TID 19) on raj-Lenovo-Y50-70, executor 1: java.lang.NumberFormatException (empty String) [duplicate 1]
18/07/26 08:22:20 INFO TaskSetManager: Starting task 0.2 in stage 11.0 (TID 20, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:22:20 INFO TaskSetManager: Lost task 0.2 in stage 11.0 (TID 20) on raj-Lenovo-Y50-70, executor 1: java.lang.NumberFormatException (empty String) [duplicate 2]
18/07/26 08:22:20 INFO TaskSetManager: Starting task 0.3 in stage 11.0 (TID 21, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:22:20 INFO TaskSetManager: Lost task 0.3 in stage 11.0 (TID 21) on raj-Lenovo-Y50-70, executor 1: java.lang.NumberFormatException (empty String) [duplicate 3]
18/07/26 08:22:20 ERROR TaskSetManager: Task 0 in stage 11.0 failed 4 times; aborting job
18/07/26 08:22:20 INFO YarnScheduler: Removed TaskSet 11.0, whose tasks have all completed, from pool 
18/07/26 08:22:20 INFO YarnScheduler: Cancelling stage 11
18/07/26 08:22:20 INFO DAGScheduler: ResultStage 11 (sortByKey at <console>:25) failed in 0.160 s due to Job aborted due to stage failure: Task 0 in stage 11.0 failed 4 times, most recent failure: Lost task 0.3 in stage 11.0 (TID 21, raj-Lenovo-Y50-70, executor 1): java.lang.NumberFormatException: empty String
	at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1842)
	at sun.misc.FloatingDecimal.parseFloat(FloatingDecimal.java:122)
	at java.lang.Float.parseFloat(Float.java:451)
	at scala.collection.immutable.StringLike$class.toFloat(StringLike.scala:280)
	at scala.collection.immutable.StringOps.toFloat(StringOps.scala:29)
	at $line27.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$anonfun$1.apply(<console>:26)
	at $line27.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$anonfun$1.apply(<console>:26)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at org.apache.spark.util.random.SamplingUtils$.reservoirSampleAndCount(SamplingUtils.scala:58)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:303)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:301)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:109)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)

Driver stacktrace:
18/07/26 08:22:20 INFO DAGScheduler: Job 8 failed: sortByKey at <console>:25, took 0.164845 s
18/07/26 08:22:20 INFO ContextCleaner: Cleaned accumulator 294
18/07/26 08:22:20 INFO ContextCleaner: Cleaned accumulator 275
18/07/26 08:22:20 INFO ContextCleaner: Cleaned accumulator 298
18/07/26 08:22:20 INFO ContextCleaner: Cleaned accumulator 277
18/07/26 08:22:20 INFO ContextCleaner: Cleaned accumulator 293
18/07/26 08:22:20 INFO BlockManagerInfo: Removed broadcast_12_piece0 on 192.168.1.105:45155 in memory (size: 2.2 KB, free: 366.3 MB)
18/07/26 08:22:20 INFO BlockManagerInfo: Removed broadcast_12_piece0 on raj-Lenovo-Y50-70:38481 in memory (size: 2.2 KB, free: 93.3 MB)
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 282
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 276
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 280
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 299
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 296
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 297
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 290
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 291
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 285
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 292
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 278
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 287
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 289
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 295
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 284
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 281
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 286
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 283
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 279
18/07/26 08:22:21 INFO ContextCleaner: Cleaned accumulator 288
org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 11.0 failed 4 times, most recent failure: Lost task 0.3 in stage 11.0 (TID 21, raj-Lenovo-Y50-70, executor 1): java.lang.NumberFormatException: empty String
	at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1842)
	at sun.misc.FloatingDecimal.parseFloat(FloatingDecimal.java:122)
	at java.lang.Float.parseFloat(Float.java:451)
	at scala.collection.immutable.StringLike$class.toFloat(StringLike.scala:280)
	at scala.collection.immutable.StringOps.toFloat(StringOps.scala:29)
	at $anonfun$1.apply(<console>:26)
	at $anonfun$1.apply(<console>:26)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at org.apache.spark.util.random.SamplingUtils$.reservoirSampleAndCount(SamplingUtils.scala:58)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:303)
	at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:301)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:109)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)

Driver stacktrace:
  at org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1602)
  at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1590)
  at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1589)
  at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)
  at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)
  at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1589)
  at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:831)
  at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:831)
  at scala.Option.foreach(Option.scala:257)
  at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:831)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1823)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1772)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1761)
  at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)
  at org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:642)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2034)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2055)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2074)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2099)
  at org.apache.spark.rdd.RDD$$anonfun$collect$1.apply(RDD.scala:939)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)
  at org.apache.spark.rdd.RDD.withScope(RDD.scala:363)
  at org.apache.spark.rdd.RDD.collect(RDD.scala:938)
  at org.apache.spark.RangePartitioner$.sketch(Partitioner.scala:306)
  at org.apache.spark.RangePartitioner.<init>(Partitioner.scala:168)
  at org.apache.spark.RangePartitioner.<init>(Partitioner.scala:148)
  at org.apache.spark.rdd.OrderedRDDFunctions$$anonfun$sortByKey$1.apply(OrderedRDDFunctions.scala:62)
  at org.apache.spark.rdd.OrderedRDDFunctions$$anonfun$sortByKey$1.apply(OrderedRDDFunctions.scala:61)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)
  at org.apache.spark.rdd.RDD.withScope(RDD.scala:363)
  at org.apache.spark.rdd.OrderedRDDFunctions.sortByKey(OrderedRDDFunctions.scala:61)
  ... 49 elided
Caused by: java.lang.NumberFormatException: empty String
  at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1842)
  at sun.misc.FloatingDecimal.parseFloat(FloatingDecimal.java:122)
  at java.lang.Float.parseFloat(Float.java:451)
  at scala.collection.immutable.StringLike$class.toFloat(StringLike.scala:280)
  at scala.collection.immutable.StringOps.toFloat(StringOps.scala:29)
  at $anonfun$1.apply(<console>:26)
  at $anonfun$1.apply(<console>:26)
  at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
  at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
  at org.apache.spark.util.random.SamplingUtils$.reservoirSampleAndCount(SamplingUtils.scala:58)
  at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:303)
  at org.apache.spark.RangePartitioner$$anonfun$13.apply(Partitioner.scala:301)
  at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
  at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndex$1$$anonfun$apply$26.apply(RDD.scala:847)
  at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
  at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
  at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
  at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
  at org.apache.spark.scheduler.Task.run(Task.scala:109)
  at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  at java.lang.Thread.run(Thread.java:745)

scala> //It is failing because,one of the key has empty string

scala> val productsMap = products.
     |   filter(product => product.split(",")(4) != "").
     |   map(product => ((product.split(",")(1).toInt, -product.split(",")(4).toFloat), product))
productsMap: org.apache.spark.rdd.RDD[((Int, Float), String)] = MapPartitionsRDD[16] at map at <console>:27

scala> val productsSortedByCategoryId = productsMap.sortByKey(false)
18/07/26 08:23:16 INFO SparkContext: Starting job: sortByKey at <console>:25
18/07/26 08:23:16 INFO DAGScheduler: Got job 9 (sortByKey at <console>:25) with 2 output partitions
18/07/26 08:23:16 INFO DAGScheduler: Final stage: ResultStage 12 (sortByKey at <console>:25)
18/07/26 08:23:16 INFO DAGScheduler: Parents of final stage: List()
18/07/26 08:23:16 INFO DAGScheduler: Missing parents: List()
18/07/26 08:23:16 INFO DAGScheduler: Submitting ResultStage 12 (MapPartitionsRDD[18] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:23:16 INFO MemoryStore: Block broadcast_13 stored as values in memory (estimated size 4.1 KB, free 366.0 MB)
18/07/26 08:23:16 INFO MemoryStore: Block broadcast_13_piece0 stored as bytes in memory (estimated size 2.3 KB, free 366.0 MB)
18/07/26 08:23:16 INFO BlockManagerInfo: Added broadcast_13_piece0 in memory on 192.168.1.105:45155 (size: 2.3 KB, free: 366.3 MB)
18/07/26 08:23:16 INFO SparkContext: Created broadcast 13 from broadcast at DAGScheduler.scala:1039
18/07/26 08:23:16 INFO DAGScheduler: Submitting 2 missing tasks from ResultStage 12 (MapPartitionsRDD[18] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:23:16 INFO YarnScheduler: Adding task set 12.0 with 2 tasks
18/07/26 08:23:16 INFO TaskSetManager: Starting task 0.0 in stage 12.0 (TID 22, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:23:16 INFO BlockManagerInfo: Added broadcast_13_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.3 KB, free: 93.3 MB)
18/07/26 08:23:16 INFO TaskSetManager: Starting task 1.0 in stage 12.0 (TID 23, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7917 bytes)
18/07/26 08:23:16 INFO TaskSetManager: Finished task 0.0 in stage 12.0 (TID 22) in 39 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:23:16 INFO TaskSetManager: Finished task 1.0 in stage 12.0 (TID 23) in 16 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:23:16 INFO YarnScheduler: Removed TaskSet 12.0, whose tasks have all completed, from pool 
18/07/26 08:23:16 INFO DAGScheduler: ResultStage 12 (sortByKey at <console>:25) finished in 0.153 s
18/07/26 08:23:16 INFO DAGScheduler: Job 9 finished: sortByKey at <console>:25, took 0.155268 s
productsSortedByCategoryId: org.apache.spark.rdd.RDD[((Int, Float), String)] = ShuffledRDD[19] at sortByKey at <console>:25

scala> productsSortedByCategoryId.take(10).foreach(println)
18/07/26 08:23:33 INFO SparkContext: Starting job: take at <console>:26
18/07/26 08:23:33 INFO DAGScheduler: Registering RDD 16 (map at <console>:27)
18/07/26 08:23:33 INFO DAGScheduler: Got job 10 (take at <console>:26) with 1 output partitions
18/07/26 08:23:33 INFO DAGScheduler: Final stage: ResultStage 14 (take at <console>:26)
18/07/26 08:23:33 INFO DAGScheduler: Parents of final stage: List(ShuffleMapStage 13)
18/07/26 08:23:33 INFO DAGScheduler: Missing parents: List(ShuffleMapStage 13)
18/07/26 08:23:33 INFO DAGScheduler: Submitting ShuffleMapStage 13 (MapPartitionsRDD[16] at map at <console>:27), which has no missing parents
18/07/26 08:23:33 INFO MemoryStore: Block broadcast_14 stored as values in memory (estimated size 5.1 KB, free 366.0 MB)
18/07/26 08:23:33 INFO MemoryStore: Block broadcast_14_piece0 stored as bytes in memory (estimated size 2.8 KB, free 366.0 MB)
18/07/26 08:23:33 INFO BlockManagerInfo: Added broadcast_14_piece0 in memory on 192.168.1.105:45155 (size: 2.8 KB, free: 366.3 MB)
18/07/26 08:23:33 INFO SparkContext: Created broadcast 14 from broadcast at DAGScheduler.scala:1039
18/07/26 08:23:33 INFO DAGScheduler: Submitting 2 missing tasks from ShuffleMapStage 13 (MapPartitionsRDD[16] at map at <console>:27) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:23:33 INFO YarnScheduler: Adding task set 13.0 with 2 tasks
18/07/26 08:23:33 INFO TaskSetManager: Starting task 0.0 in stage 13.0 (TID 24, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7906 bytes)
18/07/26 08:23:33 INFO BlockManagerInfo: Added broadcast_14_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.8 KB, free: 93.3 MB)
18/07/26 08:23:33 INFO TaskSetManager: Starting task 1.0 in stage 13.0 (TID 25, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7906 bytes)
18/07/26 08:23:33 INFO TaskSetManager: Finished task 0.0 in stage 13.0 (TID 24) in 60 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:23:33 INFO TaskSetManager: Finished task 1.0 in stage 13.0 (TID 25) in 25 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:23:33 INFO YarnScheduler: Removed TaskSet 13.0, whose tasks have all completed, from pool 
18/07/26 08:23:33 INFO DAGScheduler: ShuffleMapStage 13 (map at <console>:27) finished in 0.153 s
18/07/26 08:23:33 INFO DAGScheduler: looking for newly runnable stages
18/07/26 08:23:33 INFO DAGScheduler: running: Set()
18/07/26 08:23:33 INFO DAGScheduler: waiting: Set(ResultStage 14)
18/07/26 08:23:33 INFO DAGScheduler: failed: Set()
18/07/26 08:23:33 INFO DAGScheduler: Submitting ResultStage 14 (ShuffledRDD[19] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:23:33 INFO MemoryStore: Block broadcast_15 stored as values in memory (estimated size 3.3 KB, free 366.0 MB)
18/07/26 08:23:33 INFO MemoryStore: Block broadcast_15_piece0 stored as bytes in memory (estimated size 1984.0 B, free 366.0 MB)
18/07/26 08:23:33 INFO BlockManagerInfo: Added broadcast_15_piece0 in memory on 192.168.1.105:45155 (size: 1984.0 B, free: 366.3 MB)
18/07/26 08:23:33 INFO SparkContext: Created broadcast 15 from broadcast at DAGScheduler.scala:1039
18/07/26 08:23:33 INFO DAGScheduler: Submitting 1 missing tasks from ResultStage 14 (ShuffledRDD[19] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0))
18/07/26 08:23:33 INFO YarnScheduler: Adding task set 14.0 with 1 tasks
18/07/26 08:23:33 INFO TaskSetManager: Starting task 0.0 in stage 14.0 (TID 26, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7660 bytes)
18/07/26 08:23:33 INFO BlockManagerInfo: Added broadcast_15_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 1984.0 B, free: 93.3 MB)
18/07/26 08:23:33 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 3 to 192.168.1.105:42054
18/07/26 08:23:33 INFO TaskSetManager: Finished task 0.0 in stage 14.0 (TID 26) in 57 ms on raj-Lenovo-Y50-70 (executor 1) (1/1)
18/07/26 08:23:33 INFO YarnScheduler: Removed TaskSet 14.0, whose tasks have all completed, from pool 
18/07/26 08:23:33 INFO DAGScheduler: ResultStage 14 (take at <console>:26) finished in 0.071 s
18/07/26 08:23:33 INFO DAGScheduler: Job 10 finished: take at <console>:26, took 0.227487 s
((59,-28.0),1329,59,Nike Men's Cleveland Browns Johnny Football O,,28.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+Johnny+Football+Orange+T-Shirt)
((59,-30.0),1322,59,Nike Men's Cleveland Browns 'Money Manziel' T,,30.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+%27Money+Manziel%27+T-Shirt)
((59,-30.0),1324,59,Nike Men's Cleveland Browns Johnny Manziel 'M,,30.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+Johnny+Manziel+%27Money%27+T-Shirt)
((59,-30.0),1325,59,Nike Johnny Football Camo Graphic T-Shirt,,30.0,http://images.acmesports.sports/Nike+Johnny+Football+Camo+Graphic+T-Shirt)
((59,-30.0),1327,59,Nike Johnny Football Camo Jersey T-Shirt,,30.0,http://images.acmesports.sports/Nike+Johnny+Football+Camo+Jersey+T-Shirt)
((59,-32.0),1328,59,Nike Men's Cleveland Browns Johnny Manziel #2,,32.0,http://images.acmesports.sports/Nike+Men%27s+Cleveland+Browns+Johnny+Manziel+%232+Brown+T-Shirt)
((59,-32.0),1342,59,Nike Men's St. Louis Rams Michael Sam #96 Nam,,32.0,http://images.acmesports.sports/Nike+Men%27s+St.+Louis+Rams+Michael+Sam+%2396+Name+and+Number...)
((59,-34.0),1341,59,Nike Women's Cleveland Browns Johnny Football,,34.0,http://images.acmesports.sports/Nike+Women%27s+Cleveland+Browns+Johnny+Football+Orange+T-Shirt)
((59,-69.97),1340,59,"Majestic Men's Replica Texas Rangers Russell ",,69.97,http://images.acmesports.sports/Majestic+Men%27s+Replica+Texas+Rangers+Russell+Wilson+%233+Home...)
((59,-70.0),1326,59,"Nike Youth Home Game Jersey Cleveland Browns ",,70.0,http://images.acmesports.sports/Nike+Youth+Home+Game+Jersey+Cleveland+Browns+Johnny+Manziel...)

scala> 18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 368
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 349
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 332
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 357
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 318
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 340
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 347
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 373
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 358
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 300
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 367
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 364
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 359
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 350
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 370
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 304
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 346
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 314
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 343
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 331
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 335
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 354
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 352
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 341
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 372
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 325
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 333
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 328
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 323
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 361
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 337
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 310
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 326
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 344
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 313
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_14_piece0 on 192.168.1.105:45155 in memory (size: 2.8 KB, free: 366.3 MB)
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_14_piece0 on raj-Lenovo-Y50-70:38481 in memory (size: 2.8 KB, free: 93.3 MB)
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 360
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 324
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 312
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 336
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 363
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 362
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 311
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 327
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 308
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 321
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 329
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 355
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 371
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 307
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 322
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 301
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 319
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 356
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 365
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 366
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 369
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 334
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_13_piece0 on 192.168.1.105:45155 in memory (size: 2.3 KB, free: 366.3 MB)
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_13_piece0 on raj-Lenovo-Y50-70:38481 in memory (size: 2.3 KB, free: 93.3 MB)
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 302
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 320
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 342
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 305
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 330
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 374
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 306
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 348
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 345
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 339
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 309
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 316
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 351
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 317
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 303
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_15_piece0 on 192.168.1.105:45155 in memory (size: 1984.0 B, free: 366.3 MB)
18/07/26 08:23:55 INFO BlockManagerInfo: Removed broadcast_15_piece0 on raj-Lenovo-Y50-70:38481 in memory (size: 1984.0 B, free: 93.3 MB)
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 353
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 315
18/07/26 08:23:55 INFO ContextCleaner: Cleaned accumulator 338


scala> val productsSortedByCategoryId = productsMap.sortByKey()
18/07/26 08:24:58 INFO SparkContext: Starting job: sortByKey at <console>:25
18/07/26 08:24:58 INFO DAGScheduler: Got job 11 (sortByKey at <console>:25) with 2 output partitions
18/07/26 08:24:58 INFO DAGScheduler: Final stage: ResultStage 15 (sortByKey at <console>:25)
18/07/26 08:24:58 INFO DAGScheduler: Parents of final stage: List()
18/07/26 08:24:58 INFO DAGScheduler: Missing parents: List()
18/07/26 08:24:58 INFO DAGScheduler: Submitting ResultStage 15 (MapPartitionsRDD[21] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:24:58 INFO MemoryStore: Block broadcast_16 stored as values in memory (estimated size 4.1 KB, free 366.0 MB)
18/07/26 08:24:58 INFO MemoryStore: Block broadcast_16_piece0 stored as bytes in memory (estimated size 2.3 KB, free 366.0 MB)
18/07/26 08:24:58 INFO BlockManagerInfo: Added broadcast_16_piece0 in memory on 192.168.1.105:45155 (size: 2.3 KB, free: 366.3 MB)
18/07/26 08:24:58 INFO SparkContext: Created broadcast 16 from broadcast at DAGScheduler.scala:1039
18/07/26 08:24:58 INFO DAGScheduler: Submitting 2 missing tasks from ResultStage 15 (MapPartitionsRDD[21] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:24:58 INFO YarnScheduler: Adding task set 15.0 with 2 tasks
18/07/26 08:24:58 INFO TaskSetManager: Starting task 0.0 in stage 15.0 (TID 27, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:24:58 INFO BlockManagerInfo: Added broadcast_16_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.3 KB, free: 93.3 MB)
18/07/26 08:24:58 INFO TaskSetManager: Starting task 1.0 in stage 15.0 (TID 28, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7917 bytes)
18/07/26 08:24:58 INFO TaskSetManager: Finished task 0.0 in stage 15.0 (TID 27) in 24 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:24:58 INFO TaskSetManager: Finished task 1.0 in stage 15.0 (TID 28) in 16 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:24:58 INFO YarnScheduler: Removed TaskSet 15.0, whose tasks have all completed, from pool 
18/07/26 08:24:58 INFO DAGScheduler: ResultStage 15 (sortByKey at <console>:25) finished in 0.043 s
18/07/26 08:24:58 INFO DAGScheduler: Job 11 finished: sortByKey at <console>:25, took 0.044961 s
productsSortedByCategoryId: org.apache.spark.rdd.RDD[((Int, Float), String)] = ShuffledRDD[22] at sortByKey at <console>:25

scala> productsSortedByCategoryId.take(10).foreach(println)
18/07/26 08:25:00 INFO SparkContext: Starting job: take at <console>:26
18/07/26 08:25:00 INFO DAGScheduler: Registering RDD 16 (map at <console>:27)
18/07/26 08:25:00 INFO DAGScheduler: Got job 12 (take at <console>:26) with 1 output partitions
18/07/26 08:25:00 INFO DAGScheduler: Final stage: ResultStage 17 (take at <console>:26)
18/07/26 08:25:00 INFO DAGScheduler: Parents of final stage: List(ShuffleMapStage 16)
18/07/26 08:25:00 INFO DAGScheduler: Missing parents: List(ShuffleMapStage 16)
18/07/26 08:25:00 INFO DAGScheduler: Submitting ShuffleMapStage 16 (MapPartitionsRDD[16] at map at <console>:27), which has no missing parents
18/07/26 08:25:00 INFO MemoryStore: Block broadcast_17 stored as values in memory (estimated size 5.0 KB, free 366.0 MB)
18/07/26 08:25:00 INFO MemoryStore: Block broadcast_17_piece0 stored as bytes in memory (estimated size 2.8 KB, free 366.0 MB)
18/07/26 08:25:00 INFO BlockManagerInfo: Added broadcast_17_piece0 in memory on 192.168.1.105:45155 (size: 2.8 KB, free: 366.3 MB)
18/07/26 08:25:00 INFO SparkContext: Created broadcast 17 from broadcast at DAGScheduler.scala:1039
18/07/26 08:25:00 INFO DAGScheduler: Submitting 2 missing tasks from ShuffleMapStage 16 (MapPartitionsRDD[16] at map at <console>:27) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:25:00 INFO YarnScheduler: Adding task set 16.0 with 2 tasks
18/07/26 08:25:00 INFO TaskSetManager: Starting task 0.0 in stage 16.0 (TID 29, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7906 bytes)
18/07/26 08:25:00 INFO BlockManagerInfo: Added broadcast_17_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.8 KB, free: 93.3 MB)
18/07/26 08:25:00 INFO TaskSetManager: Starting task 1.0 in stage 16.0 (TID 30, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7906 bytes)
18/07/26 08:25:00 INFO TaskSetManager: Finished task 0.0 in stage 16.0 (TID 29) in 35 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:25:00 INFO TaskSetManager: Finished task 1.0 in stage 16.0 (TID 30) in 26 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:25:00 INFO YarnScheduler: Removed TaskSet 16.0, whose tasks have all completed, from pool 
18/07/26 08:25:00 INFO DAGScheduler: ShuffleMapStage 16 (map at <console>:27) finished in 0.063 s
18/07/26 08:25:00 INFO DAGScheduler: looking for newly runnable stages
18/07/26 08:25:00 INFO DAGScheduler: running: Set()
18/07/26 08:25:00 INFO DAGScheduler: waiting: Set(ResultStage 17)
18/07/26 08:25:00 INFO DAGScheduler: failed: Set()
18/07/26 08:25:00 INFO DAGScheduler: Submitting ResultStage 17 (ShuffledRDD[22] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:25:00 INFO MemoryStore: Block broadcast_18 stored as values in memory (estimated size 3.3 KB, free 366.0 MB)
18/07/26 08:25:00 INFO MemoryStore: Block broadcast_18_piece0 stored as bytes in memory (estimated size 1967.0 B, free 366.0 MB)
18/07/26 08:25:00 INFO BlockManagerInfo: Added broadcast_18_piece0 in memory on 192.168.1.105:45155 (size: 1967.0 B, free: 366.3 MB)
18/07/26 08:25:00 INFO SparkContext: Created broadcast 18 from broadcast at DAGScheduler.scala:1039
18/07/26 08:25:00 INFO DAGScheduler: Submitting 1 missing tasks from ResultStage 17 (ShuffledRDD[22] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0))
18/07/26 08:25:00 INFO YarnScheduler: Adding task set 17.0 with 1 tasks
18/07/26 08:25:00 INFO TaskSetManager: Starting task 0.0 in stage 17.0 (TID 31, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7660 bytes)
18/07/26 08:25:00 INFO BlockManagerInfo: Added broadcast_18_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 1967.0 B, free: 93.3 MB)
18/07/26 08:25:00 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 4 to 192.168.1.105:42054
18/07/26 08:25:00 INFO TaskSetManager: Finished task 0.0 in stage 17.0 (TID 31) in 65 ms on raj-Lenovo-Y50-70 (executor 1) (1/1)
18/07/26 08:25:00 INFO YarnScheduler: Removed TaskSet 17.0, whose tasks have all completed, from pool 
18/07/26 08:25:00 INFO DAGScheduler: ResultStage 17 (take at <console>:26) finished in 0.081 s
18/07/26 08:25:00 INFO DAGScheduler: Job 12 finished: take at <console>:26, took 0.149493 s
((2,-299.99),16,2,Riddell Youth 360 Custom Football Helmet,,299.99,http://images.acmesports.sports/Riddell+Youth+360+Custom+Football+Helmet)
((2,-209.99),11,2,Fitness Gear 300 lb Olympic Weight Set,,209.99,http://images.acmesports.sports/Fitness+Gear+300+lb+Olympic+Weight+Set)
((2,-199.99),5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet)
((2,-199.99),14,2,Quik Shade Summit SX170 10 FT. x 10 FT. Canop,,199.99,http://images.acmesports.sports/Quik+Shade+Summit+SX170+10+FT.+x+10+FT.+Canopy)
((2,-139.99),12,2,Under Armour Men's Highlight MC Alter Ego Fla,,139.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Alter+Ego+Flash+Football...)
((2,-139.99),23,2,Under Armour Men's Highlight MC Alter Ego Hul,,139.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Alter+Ego+Hulk+Football...)
((2,-134.99),6,2,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat)
((2,-129.99),2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
((2,-129.99),8,2,Nike Men's Vapor Carbon Elite TD Football Cle,,129.99,http://images.acmesports.sports/Nike+Men%27s+Vapor+Carbon+Elite+TD+Football+Cleat)
((2,-129.99),10,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)


scala> val productsSortedByCategoryId = productsMap.sortByKey().map(rec => rec._2)
18/07/26 08:27:32 INFO SparkContext: Starting job: sortByKey at <console>:25
18/07/26 08:27:32 INFO DAGScheduler: Got job 14 (sortByKey at <console>:25) with 2 output partitions
18/07/26 08:27:32 INFO DAGScheduler: Final stage: ResultStage 19 (sortByKey at <console>:25)
18/07/26 08:27:32 INFO DAGScheduler: Parents of final stage: List()
18/07/26 08:27:32 INFO DAGScheduler: Missing parents: List()
18/07/26 08:27:32 INFO DAGScheduler: Submitting ResultStage 19 (MapPartitionsRDD[27] at sortByKey at <console>:25), which has no missing parents
18/07/26 08:27:32 INFO MemoryStore: Block broadcast_20 stored as values in memory (estimated size 4.1 KB, free 366.0 MB)
18/07/26 08:27:32 INFO MemoryStore: Block broadcast_20_piece0 stored as bytes in memory (estimated size 2.3 KB, free 366.0 MB)
18/07/26 08:27:32 INFO BlockManagerInfo: Added broadcast_20_piece0 in memory on 192.168.1.105:45155 (size: 2.3 KB, free: 366.3 MB)
18/07/26 08:27:32 INFO SparkContext: Created broadcast 20 from broadcast at DAGScheduler.scala:1039
18/07/26 08:27:32 INFO DAGScheduler: Submitting 2 missing tasks from ResultStage 19 (MapPartitionsRDD[27] at sortByKey at <console>:25) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:27:32 INFO YarnScheduler: Adding task set 19.0 with 2 tasks
18/07/26 08:27:32 INFO TaskSetManager: Starting task 0.0 in stage 19.0 (TID 34, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7917 bytes)
18/07/26 08:27:32 INFO BlockManagerInfo: Added broadcast_20_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.3 KB, free: 93.3 MB)
18/07/26 08:27:32 INFO TaskSetManager: Starting task 1.0 in stage 19.0 (TID 35, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7917 bytes)
18/07/26 08:27:32 INFO TaskSetManager: Finished task 0.0 in stage 19.0 (TID 34) in 21 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:27:33 INFO TaskSetManager: Finished task 1.0 in stage 19.0 (TID 35) in 16 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:27:33 INFO YarnScheduler: Removed TaskSet 19.0, whose tasks have all completed, from pool 
18/07/26 08:27:33 INFO DAGScheduler: ResultStage 19 (sortByKey at <console>:25) finished in 0.043 s
18/07/26 08:27:33 INFO DAGScheduler: Job 14 finished: sortByKey at <console>:25, took 0.044880 s
productsSortedByCategoryId: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[29] at map at <console>:25

scala> productsSortedByCategoryId.take(10).foreach(println)
18/07/26 08:27:35 INFO SparkContext: Starting job: take at <console>:26
18/07/26 08:27:35 INFO DAGScheduler: Registering RDD 16 (map at <console>:27)
18/07/26 08:27:35 INFO DAGScheduler: Got job 15 (take at <console>:26) with 1 output partitions
18/07/26 08:27:35 INFO DAGScheduler: Final stage: ResultStage 21 (take at <console>:26)
18/07/26 08:27:35 INFO DAGScheduler: Parents of final stage: List(ShuffleMapStage 20)
18/07/26 08:27:35 INFO DAGScheduler: Missing parents: List(ShuffleMapStage 20)
18/07/26 08:27:35 INFO DAGScheduler: Submitting ShuffleMapStage 20 (MapPartitionsRDD[16] at map at <console>:27), which has no missing parents
18/07/26 08:27:35 INFO MemoryStore: Block broadcast_21 stored as values in memory (estimated size 5.0 KB, free 366.0 MB)
18/07/26 08:27:35 INFO MemoryStore: Block broadcast_21_piece0 stored as bytes in memory (estimated size 2.8 KB, free 366.0 MB)
18/07/26 08:27:35 INFO BlockManagerInfo: Added broadcast_21_piece0 in memory on 192.168.1.105:45155 (size: 2.8 KB, free: 366.3 MB)
18/07/26 08:27:35 INFO SparkContext: Created broadcast 21 from broadcast at DAGScheduler.scala:1039
18/07/26 08:27:35 INFO DAGScheduler: Submitting 2 missing tasks from ShuffleMapStage 20 (MapPartitionsRDD[16] at map at <console>:27) (first 15 tasks are for partitions Vector(0, 1))
18/07/26 08:27:35 INFO YarnScheduler: Adding task set 20.0 with 2 tasks
18/07/26 08:27:35 INFO TaskSetManager: Starting task 0.0 in stage 20.0 (TID 36, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7906 bytes)
18/07/26 08:27:35 INFO BlockManagerInfo: Added broadcast_21_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.8 KB, free: 93.3 MB)
18/07/26 08:27:35 INFO TaskSetManager: Starting task 1.0 in stage 20.0 (TID 37, raj-Lenovo-Y50-70, executor 1, partition 1, NODE_LOCAL, 7906 bytes)
18/07/26 08:27:35 INFO TaskSetManager: Finished task 0.0 in stage 20.0 (TID 36) in 25 ms on raj-Lenovo-Y50-70 (executor 1) (1/2)
18/07/26 08:27:35 INFO TaskSetManager: Finished task 1.0 in stage 20.0 (TID 37) in 17 ms on raj-Lenovo-Y50-70 (executor 1) (2/2)
18/07/26 08:27:35 INFO YarnScheduler: Removed TaskSet 20.0, whose tasks have all completed, from pool 
18/07/26 08:27:35 INFO DAGScheduler: ShuffleMapStage 20 (map at <console>:27) finished in 0.044 s
18/07/26 08:27:35 INFO DAGScheduler: looking for newly runnable stages
18/07/26 08:27:35 INFO DAGScheduler: running: Set()
18/07/26 08:27:35 INFO DAGScheduler: waiting: Set(ResultStage 21)
18/07/26 08:27:35 INFO DAGScheduler: failed: Set()
18/07/26 08:27:35 INFO DAGScheduler: Submitting ResultStage 21 (MapPartitionsRDD[29] at map at <console>:25), which has no missing parents
18/07/26 08:27:35 INFO MemoryStore: Block broadcast_22 stored as values in memory (estimated size 3.7 KB, free 366.0 MB)
18/07/26 08:27:35 INFO MemoryStore: Block broadcast_22_piece0 stored as bytes in memory (estimated size 2.1 KB, free 366.0 MB)
18/07/26 08:27:35 INFO BlockManagerInfo: Added broadcast_22_piece0 in memory on 192.168.1.105:45155 (size: 2.1 KB, free: 366.3 MB)
18/07/26 08:27:35 INFO SparkContext: Created broadcast 22 from broadcast at DAGScheduler.scala:1039
18/07/26 08:27:35 INFO DAGScheduler: Submitting 1 missing tasks from ResultStage 21 (MapPartitionsRDD[29] at map at <console>:25) (first 15 tasks are for partitions Vector(0))
18/07/26 08:27:35 INFO YarnScheduler: Adding task set 21.0 with 1 tasks
18/07/26 08:27:35 INFO TaskSetManager: Starting task 0.0 in stage 21.0 (TID 38, raj-Lenovo-Y50-70, executor 1, partition 0, NODE_LOCAL, 7660 bytes)
18/07/26 08:27:35 INFO BlockManagerInfo: Added broadcast_22_piece0 in memory on raj-Lenovo-Y50-70:38481 (size: 2.1 KB, free: 93.3 MB)
18/07/26 08:27:35 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 5 to 192.168.1.105:42054
18/07/26 08:27:35 INFO TaskSetManager: Finished task 0.0 in stage 21.0 (TID 38) in 44 ms on raj-Lenovo-Y50-70 (executor 1) (1/1)
18/07/26 08:27:35 INFO YarnScheduler: Removed TaskSet 21.0, whose tasks have all completed, from pool 
18/07/26 08:27:35 INFO DAGScheduler: ResultStage 21 (take at <console>:26) finished in 0.049 s
18/07/26 08:27:35 INFO DAGScheduler: Job 15 finished: take at <console>:26, took 0.096365 s
16,2,Riddell Youth 360 Custom Football Helmet,,299.99,http://images.acmesports.sports/Riddell+Youth+360+Custom+Football+Helmet
11,2,Fitness Gear 300 lb Olympic Weight Set,,209.99,http://images.acmesports.sports/Fitness+Gear+300+lb+Olympic+Weight+Set
5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet
14,2,Quik Shade Summit SX170 10 FT. x 10 FT. Canop,,199.99,http://images.acmesports.sports/Quik+Shade+Summit+SX170+10+FT.+x+10+FT.+Canopy
12,2,Under Armour Men's Highlight MC Alter Ego Fla,,139.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Alter+Ego+Flash+Football...
23,2,Under Armour Men's Highlight MC Alter Ego Hul,,139.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Alter+Ego+Hulk+Football...
6,2,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat
2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat
8,2,Nike Men's Vapor Carbon Elite TD Football Cle,,129.99,http://images.acmesports.sports/Nike+Men%27s+Vapor+Carbon+Elite+TD+Football+Cleat
10,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat


------------------------

Global Ranking.

	We can sort the records and get the first 10 orders.This called Global ranking.

1) take(n)	Return an array with the first n elements of the dataset.
	
//Get top five prices in the descending order

scala> // Ranking - Global (details of top 10 products)

scala> val products = sc.textFile("/public/retail_db/products")
products: org.apache.spark.rdd.RDD[String] = /public/retail_db/products MapPartitionsRDD[1] at textFile at <console>:24

scala> products.take(10).foreach(println)

scala> val productsMap = products.
     | filter(product => product.split(",")(4)!= "")
productsMap: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[2] at filter at <console>:26

scala> productsMap.take(10).foreach(println)
1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy
2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat
3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet
6,2,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat
7,2,Schutt Youth Recruit Hybrid Custom Football H,,99.99,http://images.acmesports.sports/Schutt+Youth+Recruit+Hybrid+Custom+Football+Helmet+2014
8,2,Nike Men's Vapor Carbon Elite TD Football Cle,,129.99,http://images.acmesports.sports/Nike+Men%27s+Vapor+Carbon+Elite+TD+Football+Cleat
9,2,Nike Adult Vapor Jet 3.0 Receiver Gloves,,50.0,http://images.acmesports.sports/Nike+Adult+Vapor+Jet+3.0+Receiver+Gloves
10,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat


scala> val productsMap = products.
     | filter(product => product.split(",")(4)!= "")
productsMap: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[3] at filter at <console>:26

scala> val productsMap = products.
     | filter(product => product.split(",")(4)!= "").
     | map(product => (product.split(",")(4).toFloat, product))
productsMap: org.apache.spark.rdd.RDD[(Float, String)] = MapPartitionsRDD[5] at map at <console>:27

scala> productsMap.take(3).foreach(println)
(59.98,1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy)
(129.99,2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
(89.99,3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)

scala> val productsSortedByPrice = productsMap.sortByKey(false)
productsSortedByPrice: org.apache.spark.rdd.RDD[(Float, String)] = ShuffledRDD[8] at sortByKey at <console>:25

scala> productsMap.take(3).foreach(println)
(59.98,1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy)
(129.99,2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat)
(89.99,3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat)

scala> val productsSortedByPrice = productsMap.sortByKey()
productsSortedByPrice: org.apache.spark.rdd.RDD[(Float, String)] = ShuffledRDD[11] at sortByKey at <console>:25

scala> productsSortedByPrice.take(3).foreach(println)

(0.0,38,3,Nike Men's Hypervenom Phantom Premium FG Socc,,0.0,http://images.acmesports.sports/Nike+Men%27s+Hypervenom+Phantom+Premium+FG+Soccer+Cleat)
(0.0,388,18,Nike Men's Hypervenom Phantom Premium FG Socc,,0.0,http://images.acmesports.sports/Nike+Men%27s+Hypervenom+Phantom+Premium+FG+Soccer+Cleat)
(0.0,414,19,Nike Men's Hypervenom Phantom Premium FG Socc,,0.0,http://images.acmesports.sports/Nike+Men%27s+Hypervenom+Phantom+Premium+FG+Soccer+Cleat)

scala> val productsSortedByPrice = productsMap.sortByKey(false)
productsSortedByPrice: org.apache.spark.rdd.RDD[(Float, String)] = ShuffledRDD[14] at sortByKey at <console>:25

scala> productsSortedByPrice.take(3).foreach(println)
(1999.99,208,10,SOLE E35 Elliptical,,1999.99,http://images.acmesports.sports/SOLE+E35+Elliptical)
(1799.99,66,4,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill)
(1799.99,199,10,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill)

scala> 

scala> // Ranking - Global (details of top 10 products)

takeOrdered(n, [ordering])	Return the first n elements of the RDD using either their natural order or a custom comparator.

scala> val products = sc.textFile("/public/retail_db/products")
products: org.apache.spark.rdd.RDD[String] = /public/retail_db/products MapPartitionsRDD[1] at textFile at <console>:24

scala> products.take(10).foreach(println)
1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy
2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat
3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet
6,2,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat
7,2,Schutt Youth Recruit Hybrid Custom Football H,,99.99,http://images.acmesports.sports/Schutt+Youth+Recruit+Hybrid+Custom+Football+Helmet+2014
8,2,Nike Men's Vapor Carbon Elite TD Football Cle,,129.99,http://images.acmesports.sports/Nike+Men%27s+Vapor+Carbon+Elite+TD+Football+Cleat
9,2,Nike Adult Vapor Jet 3.0 Receiver Gloves,,50.0,http://images.acmesports.sports/Nike+Adult+Vapor+Jet+3.0+Receiver+Gloves
10,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat

scala> products.
     |   filter(product => product.split(",")(4) != "").
     | take(10).
     | foreach(println)

1,2,Quest Q64 10 FT. x 10 FT. Slant Leg Instant U,,59.98,http://images.acmesports.sports/Quest+Q64+10+FT.+x+10+FT.+Slant+Leg+Instant+Up+Canopy
2,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat
3,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
4,2,Under Armour Men's Renegade D Mid Football Cl,,89.99,http://images.acmesports.sports/Under+Armour+Men%27s+Renegade+D+Mid+Football+Cleat
5,2,Riddell Youth Revolution Speed Custom Footbal,,199.99,http://images.acmesports.sports/Riddell+Youth+Revolution+Speed+Custom+Football+Helmet
6,2,Jordan Men's VI Retro TD Football Cleat,,134.99,http://images.acmesports.sports/Jordan+Men%27s+VI+Retro+TD+Football+Cleat
7,2,Schutt Youth Recruit Hybrid Custom Football H,,99.99,http://images.acmesports.sports/Schutt+Youth+Recruit+Hybrid+Custom+Football+Helmet+2014
8,2,Nike Men's Vapor Carbon Elite TD Football Cle,,129.99,http://images.acmesports.sports/Nike+Men%27s+Vapor+Carbon+Elite+TD+Football+Cleat
9,2,Nike Adult Vapor Jet 3.0 Receiver Gloves,,50.0,http://images.acmesports.sports/Nike+Adult+Vapor+Jet+3.0+Receiver+Gloves
10,2,Under Armour Men's Highlight MC Football Clea,,129.99,http://images.acmesports.sports/Under+Armour+Men%27s+Highlight+MC+Football+Cleat

scala> products.
     |   filter(product => product.split(",")(4) != "").
     | takeOrdered(10)(Ordering[Float].reverse.on(product => product.split(",")(4).toFloat)).
     | foreach(println)

208,10,SOLE E35 Elliptical,,1999.99,http://images.acmesports.sports/SOLE+E35+Elliptical
496,22,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill
199,10,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill
66,4,SOLE F85 Treadmill,,1799.99,http://images.acmesports.sports/SOLE+F85+Treadmill
1048,47,"Spalding Beast 60"" Glass Portable Basketball ",,1099.99,http://images.acmesports.sports/Spalding+Beast+60%22+Glass+Portable+Basketball+Hoop
60,4,SOLE E25 Elliptical,,999.99,http://images.acmesports.sports/SOLE+E25+Elliptical
695,32,Callaway Women's Solaire Gems 20-Piece Comple,,999.99,http://images.acmesports.sports/Callaway+Women%27s+Solaire+Gems+20-Piece+Complete+Set+-...
197,10,SOLE E25 Elliptical,,999.99,http://images.acmesports.sports/SOLE+E25+Elliptical
694,32,Callaway Women's Solaire Gems 20-Piece Comple,,999.99,http://images.acmesports.sports/Callaway+Women%27s+Solaire+Gems+20-Piece+Complete+Set+-...
488,22,SOLE E25 Elliptical,,999.99,http://images.acmesports.sports/SOLE+E25+Elliptical




